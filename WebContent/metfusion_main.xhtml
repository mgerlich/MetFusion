<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:icecore="http://www.icefaces.org/icefaces/core"
	xmlns:ace="http://www.icefaces.org/icefaces/components"
	xmlns:ice="http://www.icesoft.com/icefaces/component">
<h:head>
	<title>MetFusion</title>
	<link id="linkRimeCss" rel="stylesheet" type="text/css"
		href="./xmlhttp/css/rime/rime.css" />
	<link id="linkStylesCss" rel="stylesheet" type="text/css"
		href="./css/styles.css" />
	<link id="linkFavicon" rel="shortcut icon" type="image/x-icon"
		href="images/icons/favicon.ico" />
</h:head>
<h:body>
	<h:form id="formMetFusion">
<!-- 	<icecore:refresh interval="10" duration="2"></icecore:refresh> -->
	<icecore:singleSubmit /> <!-- ICEfaces 2 option for partial submit of form/input values for storing/validation -->

		<div id="divheader">
<!--			<ui:include src="/WEB-INF/inc-content/header.xhtml"></ui:include>-->
<!--			<a href="http://msbi.ipb-halle.de/MetFusion/" title="MetFusion">-->
<!--				<img alt="MetFusion" class="iceGphImg" id="homelogo" src="images/appLogo.png" style="float: left; border: 0px;" />-->
<!--			</a>-->
		</div>

		<div id="div_top_connect">
			<ice:outputConnectionStatus id="outputConnectionStatusTopConnect"
				displayHourglassWhenActive="true" showPopupOnDisconnect="true"/>
		</div>

		<div id="content">
			<ice:panelTabSet id="panelTabSetMetfusion" selectedIndex="#{appBean.selectedTab}">
				<ice:panelTab id="panelTabSpectrumQuery" label="Spectrum Query">
				<div id="inputs" style="width: 100%;">
					<div id="sourceParams" style="border: 1px dashed silver; width: 65%; float: left;">
					
					<!-- stacking panel selector for spectral database -->
					<ice:panelGrid id="panelGridSpectrumDB" columns="3">
						<ice:outputLabel id="outputLabelSpectralDB" for="selectSpectralDB" value="Selected Spectral Database:"/>
						<ice:selectOneMenu id="selectSpectralDB" required="true" value="#{appBean.selectedSpectralDB}" 
							style="background-color: MintCream;">
							<f:selectItems value="#{appBean.availableSpectralDBsSI}"/>
						</ice:selectOneMenu>
						<ice:panelGroup id="panelGroupErrorSpectralDB" effect="#{appBean.effectOutputText}">
    						<ice:message id="errGenericDatabase" for="selectSpectralDB"></ice:message>
    					</ice:panelGroup>
					</ice:panelGrid>
					
					<!-- MassBank settings -->
					<ice:panelStack id="panelStackMassBank" selectedPanel="#{appBean.selectedSpectralDB}">
				    	<ice:panelGroup id="massbankSettings" style="margin-left: 10px; margin-right: 10px;">
		    				<ice:outputLabel id="outputLabelMBParams" value="MassBank Parameters" style="text-decoration: underline;"></ice:outputLabel>
		    				<br/>
		    				<ice:outputLabel id="outputLabelMBServerUrl" value="#{appBean.mblb.serverUrl}"/>
		    				<br/>
		    				<ice:panelGrid id="panelGridMassBankServer" columns="3" style="margin-left: 10px; margin-right: 10px;">
		    					<ice:panelGroup id="lblMBDB" panelTooltip="lblMBDBTooltip">
		    						<ice:outputLabel id="outputLabelMassBankServer" value="MassBank Server:"/>
		    						<ice:panelTooltip id="lblMBDBTooltip">
		    							<f:facet id="facetMassBankHeader" name="header">
		    								<ice:outputText value="MassBank Server"></ice:outputText>
		    							</f:facet>
		    							<f:facet id="facetMassBankBody" name="body">
		    								<ice:outputText value="Specify a MassBank server. Default is the japanese one
		    								at www.massbank.jp."></ice:outputText>
		    							</f:facet>
		    						</ice:panelTooltip>
		    					</ice:panelGroup>
		    					<ice:panelGroup id="panelGroupMassBankServer">
		    						<ice:selectOneMenu id="selectOneMenuMassBankServer" valueChangeListener="#{appBean.mblb.changeDatabase}" value="#{appBean.mblb.selectedServer}">
		    							<f:selectItems id="selectItemsMassBankServer" itemLabel="#{n}" itemValue="#{n}" var="n" 
											value="#{appBean.mblb.availableServers}" />
		    						</ice:selectOneMenu>
		    						<ice:panelGroup id="panelGroupEffectMassBankServer" effect="#{appBean.effectOutputText}" 
		    							style="float: right;" rendered="#{appBean.mblb.selectOtherServer}">
			    						<ice:inputText id="mbServerUrl" rendered="#{appBean.mblb.selectOtherServer}" 
			    							valueChangeListener="#{appBean.mblb.changeDatabase}" value="#{appBean.mblb.otherServer}"
			    							partialSubmit="true" immediate="true">
			    						</ice:inputText>
		    						</ice:panelGroup>
		    					</ice:panelGroup>
		    					<ice:panelGroup id="panelGroupEffectMassBankServerError" effect="#{appBean.effectOutputText}">
		    						<ice:message id="errmbServer" for="mbServer"></ice:message>
		    					</ice:panelGroup>
		    					
		    					<ice:panelGroup id="lblMBRslt" panelTooltip="lblMBRsltTooltip">
		    						<ice:outputLabel id="outputLabelMassBankNumberResults" value="Number of Results:"></ice:outputLabel>
		    						<ice:panelTooltip id="lblMBRsltTooltip">
		    							<f:facet id="facetMassBankResultsHeader" name="header">
		    								<ice:outputText value="Number of Results"></ice:outputText>
		    							</f:facet>
		    							<f:facet id="facetMassBankResultsBody" name="body">
		    								<ice:outputText value="Specify the maximum number of results.
		    								Allowed values are in the range of 1 to 500."></ice:outputText>
		    							</f:facet>
		    						</ice:panelTooltip>
		    					</ice:panelGroup>
		    					<ice:inputText id="mbResult" value="#{appBean.mblb.limit}" required="true" 
		    						requiredMessage="Please enter a number between 1 and 500." 
		    						validatorMessage="Please enter a number between 1 and 500.">
		    						<f:validator validatorId="numberValidator"/>
		    						<f:validateLongRange minimum="1" maximum="500"></f:validateLongRange>
		    					</ice:inputText>
		    					<ice:panelGroup id="panelGroupMassBankResultError" effect="#{appBean.effectOutputText}">
		    						<ice:message id="errmbResult" for="mbResult"></ice:message>
		    					</ice:panelGroup>
		    					
		    					<ice:panelGroup id="lblMBCtff" panelTooltip="lblMBCtffTooltip">
		    						<ice:outputLabel value="Cutoff threshold of relative intensities:"></ice:outputLabel>
		    						<ice:panelTooltip id="lblMBCtffTooltip">
		    							<f:facet id="facetMassBankCutoffTooltipHeader" name="header">
		    								<ice:outputText value="Cutoff threshold of relative intensities"></ice:outputText>
		    							</f:facet>
		    							<f:facet id="facetMassBankCutoffTooltipBody" name="body">
		    								<ice:outputText value="Defines the cutoff for small relative intensities.
		    								Allowed values lie in the range of 0 to 500."></ice:outputText>
		    							</f:facet>
		    						</ice:panelTooltip>
		    					</ice:panelGroup>
		    					<ice:inputText id="mbThresh" value="#{appBean.mblb.cutoff}" required="true" 
		    						requiredMessage="Please enter a number between 0 and 500."
		    						validatorMessage="Please enter a number between 0 and 500.">
		    						<f:validator validatorId="numberValidator"/>
		    						<f:validateLongRange minimum="0" maximum="500"></f:validateLongRange>
		    					</ice:inputText>
		    					<ice:panelGroup id="panelgroupMassBankThresholdError" effect="#{appBean.effectOutputText}">
		    						<ice:message id="errmbThresh" for="mbThresh"></ice:message>
		    					</ice:panelGroup>
		    					
		    					<ice:panelGroup id="lblMBIonMode" panelTooltip="lblMBIonModeTooltip">
		    						<ice:outputLabel id="outputlabelMassBankIonizationMode" value="Ionization Mode:"></ice:outputLabel>
		    						<ice:panelTooltip id="lblMBIonModeTooltip">
		    							<f:facet id="facetMassBankIonizationModeHeader" name="header">
		    								<ice:outputText value="Ionization Mode"></ice:outputText>
		    							</f:facet>
		    							<f:facet id="facetMassBankIonizationModeBody" name="body">
		    								<ice:outputText value="Defines the ionization mode for the query spectrum.
		    								Allowed values are positive mode, negative mode and both modes."></ice:outputText>
		    							</f:facet>
		    						</ice:panelTooltip>
		    					</ice:panelGroup>
		    					<ice:panelGroup id="massbankIon">
									<ice:selectOneMenu id="allIon" value="#{appBean.mblb.selectedIon}" partialSubmit="true" required="true"
										valueChangeListener="#{appBean.changeIonizationListener}">
										<f:selectItems itemLabel="#{n}" itemValue="#{n}" var="n" 
											value="#{appBean.mblb.ionisations}" />
									</ice:selectOneMenu>
								</ice:panelGroup>
								<ice:panelGroup id="panelgroupIoniziationError" effect="#{appBean.effectOutputText}">
		    						<ice:message id="errallIon" for="allIon"></ice:message>
		    					</ice:panelGroup>
		    					
		    					<!-- MS levels -->
		    					<ice:panelGroup id="lblMBMSLvls" panelTooltip="lblMBMSLvlsTooltip">
		    						<ice:outputLabel id="outputlabelMassBankMSLevel" value="MS Levels:"></ice:outputLabel>
		    						<ice:panelTooltip id="lblMBMSLvlsTooltip">
		    							<f:facet id="facetMassBankMSLevelHeader" name="header">
		    								<ice:outputText value="MS Levels"></ice:outputText>
		    							</f:facet>
		    							<f:facet id="facetMassBankMSLevelBody" name="body">
		    								<ice:outputText value="Specifies which MS level should be used for spectrum search."></ice:outputText>
		    							</f:facet>
		    						</ice:panelTooltip>
		    					</ice:panelGroup>
		    					<ice:panelGroup id="massbankMSlvl">
		    						<ice:selectManyCheckbox id="allMSLvl" value="#{appBean.mblb.selectedMSLevel}" partialSubmit="false"
		    							required="true" valueChangeListener="#{appBean.mblb.changeMSLevels}">
		    							<f:selectItems value="#{appBean.mblb.availableMSLevels}" var="n" itemLabel="#{n}" itemValue="#{n}"/>	
		    						</ice:selectManyCheckbox>
		    					</ice:panelGroup>
		    					<ice:panelGroup>
		    					
		    					</ice:panelGroup>
		    				</ice:panelGrid>
		    				
		    				<ice:panelGroup id="msgMassBank" rendered="#{appBean.mblb.brokenMassBank}"
		    					style="border: 1px solid DarkRed; background-color: MistyRose; margin: 5px;">
		    					Not all MassBank servers could be reached! Current queries will possible yield less results
		    					than expected/normal. Either proceed or try again later. You may also want to check 
		    					<a href="http://www.massbank.jp/">MassBank.jp</a> for further details.
		    				</ice:panelGroup>
							
							<ice:panelGroup style="margin-left: 10px; margin-right: 10px;">
								<ice:panelGrid columns="2" columnClasses="gridSelectItems">
									<ice:panelGroup id="lblMBInstruments" panelTooltip="lblMBInstrumentsTooltip">
										<ice:outputLabel value="Instruments:"></ice:outputLabel>
										<ice:panelTooltip id="lblMBInstrumentsTooltip">
			    							<f:facet id="facetMassBankInstrumentsHeader" name="header">
			    								<ice:outputText value="Instruments"></ice:outputText>
			    							</f:facet>
			    							<f:facet id="facetMassBankInstrumentsBody" name="body">
			    								<ice:outputText value="Select the instruments or groups used for lookup of the
			    								query spectrum. At least one selected instrument is required! Instruments are
			    								separated into groups EI, ESI and Other."></ice:outputText>
			    							</f:facet>
		    							</ice:panelTooltip>
									</ice:panelGroup>
									<ice:panelGrid id="instruments" columns="#{appBean.mblb.NUM_INST_GROUPS}" 
										columnClasses="gridSelectItems" 
										style="text-align: left; margin-left: 187px; border: 1px dotted silver;">
										<ice:panelGroup id="panelgroupMassBankInstrumentsEI" 
											rendered="#{appBean.mblb.presentEI}">
<!--											<ice:outputLabel value="EI"/>-->
<!--											<ice:selectBooleanCheckbox label="EI" value="#{appBean.mblb.useEIOnly}" style="margin-left: 5px;"-->
<!--												valueChangeListener="#{appBean.mblb.toggleInstrumentsEI}">-->
<!--												<f:param name="group" value="EI"/>-->
<!--											</ice:selectBooleanCheckbox>-->
											<ice:commandLink id="commandLinkMBInstrumentEI" 
												value="#{appBean.mblb.linkGroupEI}" actionListener="#{appBean.mblb.toggleInstrumentGroup}"
												style="color: LimeGreen; text-decoration: underline;" immediate="false">
												<!-- provide a parameter for the actionListener to differentiate the groups -->
												<f:param value="#{appBean.mblb.getEi()}" name="group"/>
											</ice:commandLink>
										</ice:panelGroup>
										<ice:panelGroup id="panelgroupMassBankInstrumentsESI" 
											rendered="#{appBean.mblb.presentESI}">
<!--											<ice:outputLabel value="ESI"/>-->
<!--											<ice:selectBooleanCheckbox label="ESI" value="#{appBean.mblb.useESIOnly}" style="margin-left: 5px;"-->
<!--												valueChangeListener="#{appBean.mblb.toggleInstrumentsESI}">-->
<!--												<f:param name="group" value="ESI"/>-->
<!--											</ice:selectBooleanCheckbox>-->
											<ice:commandLink id="commandLinkMBInstrumentESI" 
												value="#{appBean.mblb.linkGroupESI}" actionListener="#{appBean.mblb.toggleInstrumentGroup}"
												style="color: LimeGreen; text-decoration: underline;" immediate="false">
												<!-- provide a parameter for the actionListener to differentiate the groups -->
												<f:param value="#{appBean.mblb.getEsi()}" name="group"/>
											</ice:commandLink>
										</ice:panelGroup>
										<ice:panelGroup id="panelgroupMassBankInstrumentsOther" 
											rendered="#{appBean.mblb.presentOther}">
<!--											<ice:outputLabel value="Other"/>-->
<!--											<ice:selectBooleanCheckbox label="Other" value="#{appBean.mblb.useOtherOnly}" style="margin-left: 5px;">-->
<!--												valueChangeListener="#{appBean.mblb.toggleInstrumentsOther}">-->
<!--												<f:param name="group" value="Other"/>-->
<!--											</ice:selectBooleanCheckbox>-->
											<ice:commandLink id="commandLinkMBInstrumentOther" 
												value="#{appBean.mblb.linkGroupOTHER}" actionListener="#{appBean.mblb.toggleInstrumentGroup}"
												style="color: LimeGreen; text-decoration: underline;" immediate="false">
												<!-- provide a parameter for the actionListener to differentiate the groups -->
												<f:param value="#{appBean.mblb.getOther()}" name="group"/>
											</ice:commandLink>
										</ice:panelGroup>
										
										<!-- Select instruments of group EI -->
										<h:selectManyCheckbox id="selectManyCheckboxInstrumentsEI" layout="pageDirection" 
											value="#{appBean.mblb.selectedGroupInstruments[appBean.mblb.indexEI]}"
											valueChangeListener="#{appBean.mblb.changeInstruments}" immediate="true"
											rendered="#{appBean.mblb.presentEI}" style="padding-bottom: 0.625em; padding-right: 0.75em;">
<!--											validator="de.ipbhalle.metfusion.web.controller.validation.InstrumentValidator">-->
											<f:selectItems value="#{appBean.mblb.instTest[appBean.mblb.indexEI]}"/>
											<f:attribute name="attrGroup" value="#{appBean.mblb.getEi()}"/>
										</h:selectManyCheckbox>
										
										<!-- Select instruments of group ESI -->
										<h:selectManyCheckbox id="selectManyCheckboxInstrumentsESI" layout="pageDirection" 
											value="#{appBean.mblb.selectedGroupInstruments[appBean.mblb.indexESI]}"
											valueChangeListener="#{appBean.mblb.changeInstruments}" immediate="true"
											rendered="#{appBean.mblb.presentESI}" style="padding-bottom: 0.625em; padding-right: 0.75em;">
<!--											validator="de.ipbhalle.metfusion.web.controller.validation.InstrumentValidator">-->
											<f:selectItems value="#{appBean.mblb.instTest[appBean.mblb.indexESI]}"/>
											<f:attribute name="attrGroup" value="#{appBean.mblb.getEsi()}"/>
										</h:selectManyCheckbox>
										
										<!-- Select instruments of group Other -->
										<h:selectManyCheckbox id="selectManyCheckboxInstrumentsOther" layout="pageDirection" 
											value="#{appBean.mblb.selectedGroupInstruments[appBean.mblb.indexOther]}"
											valueChangeListener="#{appBean.mblb.changeInstruments}" immediate="true"
											rendered="#{appBean.mblb.presentOther}" style="padding-bottom: 0.625em; padding-right: 0.75em;">
<!--											validator="de.ipbhalle.metfusion.web.controller.validation.InstrumentValidator">-->
											<f:selectItems value="#{appBean.mblb.instTest[appBean.mblb.indexOther]}"/>
											<f:attribute name="attrGroup" value="#{appBean.mblb.getOther()}"/>
										</h:selectManyCheckbox>
									</ice:panelGrid>
								</ice:panelGrid>
							</ice:panelGroup>
							
							<ice:panelGroup id="panelgroupMassBankInstrumentsError">
								<ice:message id="errMsgInst" for="instruments"/>
							</ice:panelGroup>
							
				    	</ice:panelGroup>

						<!-- GMD settings -->
						<ice:panelGroup id="gmdSettings" style="margin-left: 10px; margin-right: 10px;">
						<ice:outputLabel id="outputlabelGMDParameters" value="GMD Parameters" 
							style="text-decoration: underline;"></ice:outputLabel>
		    				<br/>
		    				<ice:outputLabel id="outputlabelGMDServerURL" value="#{gmdBean.serverUrl}"/>
		    				<br/>
		    				<ice:panelGroup id="panelgroupGMDServer" 
		    					style="background-color: Gold; border: 1px solid Orange; margin: 10px;">
		    					<ice:outputText id="outputtextGMDInformationAnalytes" 
		    						value="Please note that GMD is queried for derivatized analytes, whereas the results presented here
		    					are the corresponding (non-derivatized) metabolites of these analytes!" />
		    				</ice:panelGroup>
					    	<ice:panelGrid id="gmdParameters" columns="3" style="margin-left: 10px; margin-right: 10px;">
					    	
						    	<ice:panelGroup id="lblGmdRI" panelTooltip="lblGmdRITooltip">
						    		<ice:outputLabel id="outputlabelGMDRetentionIndex" for="gmdRI" 
						    			value="Retention Index:"/>
						    		<ice:panelTooltip id="lblGmdRITooltip">
						    			<f:facet id="facetGMDRetentionIndexHeader" name="header">
						    				<ice:outputText value="Retention Index"/>
						    			</f:facet>
						    			<f:facet id="facetGMDRetentionIndexBody" name="body">
						    				<ice:outputText value="Numeric value for the retention time index. Please note that the retention
					    					indexes for VAR5 columns are based on n-alkane homologues, whereas indices for MDN35 columns are
					    					based on fatty acid methyl esthers (FAME)."/>
						    			</f:facet>
						    		</ice:panelTooltip>
						    	</ice:panelGroup>
					    		<ice:inputText id="gmdRI" value="#{gmdBean.ri}" required="true">
					    			<f:convertNumber pattern="####.##"/>
					    			<f:validator validatorId="numberValidator"/>
					    			<f:validateDoubleRange minimum="0.0"/>
					    		</ice:inputText>
					    		<ice:panelGroup id="panelgroupGMDRetentionIndex" effect="#{appBean.effectOutputText}">
					    			<ice:message for="gmdRI"/>
					    		</ice:panelGroup>
					    	
					    		<ice:panelGroup id="lblGmdRIwindow" panelTooltip="lblGmdRIwindowTooltip">
					    			<ice:outputLabel id="outputlabelGMDRIWindow" for="gmdRIwindow" value="Retention Index Window:"/>
					    			<ice:panelTooltip id="lblGmdRIwindowTooltip">
					    				<f:facet id="facetGMDRIHeader" name="header">
					    					<ice:outputText value="Retention Index Window"/>
					    				</f:facet>
					    				<f:facet id="facetGMDRIBody" name="body">
					    					<ice:outputText value="Numeric value for the retention index window size."/>
					    				</f:facet>
					    			</ice:panelTooltip>
					    		</ice:panelGroup>
					    		<ice:inputText id="gmdRIwindow" value="#{gmdBean.riWindow}" required="true">
					    			<f:validator validatorId="numberValidator"/>
					    			<f:validateDoubleRange minimum="0.0"/>
					    		</ice:inputText>
					    		<ice:panelGroup id="panelgroupRetentionIndexWindow" effect="#{appBean.effectOutputText}">
					    			<ice:message for="gmdRIwindow"/>
					    		</ice:panelGroup>
					    		
					    		<ice:panelGroup id="lblGmdColumn" panelTooltip="lblGmdColumnTooltip">
					    			<ice:outputLabel id="outputlabelGMDColumn" for="gmdColumn" value="GC-Column Type:"/>
					    			<ice:panelTooltip id="lblGmdColumnTooltip">
					    				<f:facet id="facetGMDColumnHeader" name="header">
					    					<ice:outputText id="outputtextGMDColumnHeader" value="Alkane Retention Index GC Column Composition"/>
					    				</f:facet>
					    				<f:facet id="facetGMDColumnBody" name="body">
					    					<ice:outputText id="outputtextGMDColumnBody" 
					    					value="Select one of the predefined GC column variants 
					    					on which the alkane retention index is based on. Current types are VAR5, MDN35 and none.
					    					VAR5 is a 5%-phenyl-95%-dimethylpolysiloxane column, while MDN35 is a 35%-phenyl-65%-dimethylpolysiloxane." 
					    					escape="false"/>
					    				</f:facet>
					    			</ice:panelTooltip>
					    		</ice:panelGroup>
					    		<ice:selectOneMenu id="gmdColumn" value="#{gmdBean.stringColumn}" required="true">
					    			<f:selectItems value="#{gmdBean.availableColumns}"/>
					    		</ice:selectOneMenu>
					    		<ice:panelGroup id="panelgroupGMDColumnEffect" effect="#{appBean.effectOutputText}">
					    			<ice:message for="gmdColumn"/>
					    		</ice:panelGroup>
					    		
					    	</ice:panelGrid>
						</ice:panelGroup>
				    	
				    	<!-- Metlin settings -->
				    	<ice:panelGroup id="metlinSettings" style="margin-left: 10px; margin-right: 10px;">
				    		<ice:outputLabel id="outputlabelMetlinParameters" value="Metlin Parameters" 
				    			style="text-decoration: underline;"></ice:outputLabel>
		    				<br/>
		    				<ice:outputLabel id="outputlabelMetlinServerUrl" value="#{metlinBean.serverUrl}"/>
		    				<br/>
					    	<ice:panelGrid id="metlinParameters" columns="3" style="margin-left: 10px; margin-right: 10px;">
					    	
					    		<ice:panelGroup id="lblMetlinMode" panelTooltip="lblMetlinModeTooltip">
					    			<ice:outputLabel id="outputlabelMetlinMode" for="metlinMode" value="Ionization Mode:"/>
					    			<ice:panelTooltip id="lblMetlinModeTooltip">
					    				<f:facet id="facetMetlinModeHeader" name="header">
					    					<ice:outputText value="Ionization Mode"/>
					    				</f:facet>
					    				<f:facet id="facetMetlinModeBody" name="body">
					    					<ice:outputText value="Select either positive or negative ionization mode for your query spectrum."/>
					    				</f:facet>
					    			</ice:panelTooltip>
					    		</ice:panelGroup>
					    		<ice:selectOneRadio id="metlinMode" required="true" value="#{metlinBean.selectedIonization}"
					    			valueChangeListener="#{appBean.changeIonizationListener}">
					    			<f:selectItem itemLabel="positive" itemValue="pos"/>
					    			<f:selectItem itemLabel="negative" itemValue="neg"/>
					    		</ice:selectOneRadio>
					    		<ice:panelGroup id="panelgroupMetlinMode" effect="#{appBean.effectOutputText}">
					    			<ice:message id="messageMetlinMode" for="metlinMode"/>
					    		</ice:panelGroup>
					    		
					    		<ice:panelGroup id="lblMetlinColEnergy" panelTooltip="lblMetlinColEnergyTooltip">
					    			<ice:outputLabel id="outputlabelMetlinColEnergy" for="metlinColEnergy" 
					    				value="Collision Energy:"/>
					    			<ice:panelTooltip id="lblMetlinColEnergyTooltip">
					    				<f:facet id="facetMetlinColEnergyHeader" name="header">
					    					<ice:outputText id="outputTextMetlinColEnergyHeader" value="Collision Energy"/>
					    				</f:facet>
					    				<f:facet id="facetMetlinColEnergyBody" name="body">
					    					<ice:outputText id="outputTextMetlinColEnergyBody" value="Specify the collision energy for the spectrum query. 
					    					Choose between 10, 20 and 40 eV."/>
					    				</f:facet>
					    			</ice:panelTooltip>
					    		</ice:panelGroup>
					    		<ice:selectOneMenu id="metlinColEnergy" required="true" value="#{metlinBean.collisionEnergy}">
					    			<f:selectItem id="selectItemMetlinColEnergy10eV" itemLabel="10 eV" itemValue="10"/>
					    			<f:selectItem id="selectItemMetlinColEnergy20eV" itemLabel="20 eV" itemValue="20"/>
					    			<f:selectItem id="selectItemMetlinColEnergy40eV" itemLabel="40 eV" itemValue="40"/>
					    		</ice:selectOneMenu>
					    		<ice:panelGroup id="panelgroupMetlinColEnergy" effect="#{appBean.effectOutputText}">
					    			<ice:message id="messageMetlinColEnergy" for="metlinColEnergy"/>
					    		</ice:panelGroup>
					    		
					    		<ice:panelGroup id="lblMetlinTolMS" panelTooltip="lblMetlinTolMSTooltip">
					    			<ice:outputLabel id="outputlabelMetlingTolMS" for="metlinToleranceMSMS" 
					    				value="Tolerance MSMS (Da):"/>
					    			<ice:panelTooltip id="lblMetlinTolMSTooltip">
					    				<f:facet id="facetMetlinTolMSHeader" name="header">
					    					<ice:outputText id="outputtextMetlinTolMSTooltipHeader" value="Tolerance MSMS"/>
					    				</f:facet>
					    				<f:facet id="facetMetlinTolMSBody" name="body">
					    					<ice:outputText id="outputtextMetlinTolMSTooltipBody" value="Specifies the tolerance of the MSMS data. 
					    					Must be between 0.001 and 0.5. Units are Da. "/>
					    				</f:facet>
					    			</ice:panelTooltip>
					    		</ice:panelGroup>
					    		<ice:inputText id="metlinToleranceMSMS" required="true" value="#{metlinBean.toleranceMSMS}">
					    			<f:validator validatorId="numberValidator"/>
					    			<f:validateDoubleRange minimum="0.001" maximum="0.5"/>
					    		</ice:inputText>
					    		<ice:panelGroup id="panelgroupMetlinTolMS" effect="#{appBean.effectOutputText}">
					    			<ice:message id="messageMetlinTolMS" for="metlinToleranceMSMS"/>
					    		</ice:panelGroup>
					    		
					    		<ice:panelGroup id="lblMetlinTolPrecursor" panelTooltip="lblMetlinTolPrecursorTooltip">
					    			<ice:outputLabel id="outputlabelMetlinTolPrecursor" for="metlinTolerancePrecursor" 
					    				value="Tolerance Precursor (ppm):"/>
					    			<ice:panelTooltip id="lblMetlinTolPrecursorTooltip">
					    				<f:facet id="facetMetlinTolPrecursorHeader" name="header">
					    					<ice:outputText id="outputtextMetlinTolPrecursorHeader" 
					    						value="Tolerance Precursor"/>
					    				</f:facet>
					    				<f:facet id="facetMetlinTolPrecursorBody" name="body">
					    					<ice:outputText id="outputtextMetlinTolPrecursorBody"  
					    					value="Specifies the tolerance of the precursor. 
					    					Must be between 1 and 100. Units are ppm. "/>
					    				</f:facet>
					    			</ice:panelTooltip>
					    		</ice:panelGroup>
					    		<ice:inputText id="metlinTolerancePrecursor" required="true" value="#{metlinBean.tolerancePrecursor}">
					    			<f:validator validatorId="numberValidator"/>
					    			<f:validateLongRange minimum="1" maximum="100"/>
					    		</ice:inputText>
					    		<ice:panelGroup id="panelgroupMetlinTolPrecursor" effect="#{appBean.effectOutputText}">
					    			<ice:message id="messageMetlinTolPrecursor" for="metlinTolerancePrecursor"/>
					    		</ice:panelGroup>
					    		
					    	</ice:panelGrid>
				    	</ice:panelGroup>
				    	
				    	<ice:panelGroup id="panelGroupErrorMessages">
							<ice:messages id="errMsgs" style="background-color: Orange;"/>
						</ice:panelGroup>
				    	
				    	</ice:panelStack>
				    	<br/>
				    	<ice:panelGroup id="panelgroupMetFragParameters" 
				    		style="margin-left: 10px; margin-right: 10px; clear: both;">
				    		<ice:outputLabel id="outputlabelMetFragParameters" value="MetFrag Parameters" 
				    			style="text-decoration: underline;"/>
				    		<ice:panelGroup id="panelgroupMetfragModeSettings" effect="#{appBean.effectNote}" 
				    			style="float: right;">
			    				<ice:outputText id="outputtextMetfragModeSetting" style="margin-left: 10px; color: Orange;" 
			    					value="#{appBean.metfragModeSetting}" escape="false"/>
			    			</ice:panelGroup>
				    		<br/>
				    		<ice:panelGrid id="panelgridMetfragParameters" columns="3" columnClasses="labels, text, errors" 
				    			style="margin-left: 10px; margin-right: 10px;">
				    			
				    			<!-- Select MetFrag upstream database -->
				    			<ice:panelGroup id="lblMFDatabase" panelTooltip="lblMFDatabaseTooltip">
									<ice:outputLabel id="outputlabelMetfragDatabase" for="metfragDatabases" 
										value="Upstream DB:"></ice:outputLabel>
									<ice:panelTooltip id="lblMFDatabaseTooltip">
		    							<f:facet id="facetMetfragDatabaseHeader" name="header">
		    								<ice:outputText id="outputtextMetfragDatabaseHeader"
		    									value="Upstream Database"></ice:outputText>
		    							</f:facet>
		    							<f:facet id="facetMetfragDatabaseBody" name="body">
		    								<ice:outputText id="outputtextMetfragDatabaseBody" 
		    								value="Select the compound database to query. A choice is required!
		    								Possible choices include KEGG, PubChem and ChemSpider."></ice:outputText>
		    							</f:facet>
	    							</ice:panelTooltip>
								</ice:panelGroup>
								<ice:selectOneRadio value="#{appBean.mfb.selectedDB}" id="metfragDatabases"
										partialSubmit="true" required="true" valueChangeListener="#{appBean.mfb.changeDatabase}">
									<f:selectItems id="selectitemMetfragDatabase" itemLabel="#{n.label}" 
										itemValue="#{n.value}" var="n" value="#{appBean.mfb.databases}" />
								</ice:selectOneRadio>
								<ice:panelGroup id="panelgroupMetfragDatabasesError" effect="#{appBean.effectOutputText}">
									<ice:message id="errmetfragDatabases" for="metfragDatabases"></ice:message>
								</ice:panelGroup>
								
								<!-- SDF upload controls -->
								<ice:panelGroup id="lblMFSDF" panelTooltip="lblMFSDFTooltip" rendered="#{appBean.mfb.renderSDF}">
									<ice:outputLabel for="dbSDF" value="SDF Upload:"/>
									<ice:panelTooltip id="lblMFSDFTooltip">
		    							<f:facet name="header">
		    								<ice:outputText value="SDF Upload"></ice:outputText>
		    							</f:facet>
		    							<f:facet name="body">
		    								<ice:outputText value="Controls for SDF upload."></ice:outputText>
		    							</f:facet>
	    							</ice:panelTooltip>
								</ice:panelGroup>
								<ice:panelGroup rendered="#{appBean.mfb.renderSDF}">
<!--									<ace:fileEntry id="fileEntrySDF" callback="#{fileMD5EncodingCallback}" rendered="#{appBean.mfb.renderSDF}" />-->
									<ace:fileEntry id="fileEntryComp" label="SDF Upload" relativePath="temp" useSessionSubdir="true"
									fileEntryListener="#{appBean.mfb.listener}" useOriginalFilename="true"  callback="#{fileMD5EncodingCallback}"
									maxFileCount="1" maxFileCountMessage="Only one file per upload allowed!" required="true" immediate="true">
<!-- 										<f:validator for="fileEntryComp" validatorId="uploadValidator"/> -->
									</ace:fileEntry>
<!-- 									<ice:commandButton value="Upload SDF" action="#{appBean.mfb.upload}"/> -->
								</ice:panelGroup>
								<ice:panelGroup effect="#{appBean.effectNote}" rendered="#{appBean.mfb.renderSDF}">
									<ice:message id="errdbSDF" for="fileEntryComp" style="color: Orange;"/>
<!-- 									<ice:outputText rendered="#{appBean.mfb.validSDF}" value="#{appBean.mfb.noteSDF}: #{appBean.mfb.selectedSDF}" -->
<!-- 										style="color: Orange;"/> -->
<!-- 									<ice:outputText rendered="#{!appBean.mfb.validSDF}" value="#{appBean.mfb.noteSDF}" -->
<!-- 									style="color: Orange;"/> -->
								</ice:panelGroup>
								
								<!-- provide database identifiers -->
								<ice:panelGroup id="lblMFDBID" panelTooltip="lblMFDBIDTooltip" rendered="#{!appBean.mfb.renderSDF}">
									<ice:outputLabel id="outputlabelMetfragDBIds" for="dbID" value="Database IDs:"></ice:outputLabel>
									<ice:panelTooltip id="lblMFDBIDTooltip">
		    							<f:facet id="facetMetfragDBIdsHeader" name="header">
		    								<ice:outputText id="outputtextMetfragDBIdsHeader" value="Database IDs"></ice:outputText>
		    							</f:facet>
		    							<f:facet id="facetMetfragDBIdsBody" name="body">
		    								<ice:outputText id="outputtextMetfragDBIdsBody" 
		    									value="Optionally provide known comma-separated list of 
		    									database identifiers for the selected compound database. 
		    									Only provided identifiers are used for the query! "></ice:outputText>
		    							</f:facet>
	    							</ice:panelTooltip>
								</ice:panelGroup>
								<ice:inputText id="dbID" value="#{appBean.mfb.databaseID}" rendered="#{!appBean.mfb.renderSDF}"></ice:inputText>
								<ice:panelGroup id="panelgroupMetfragDatabaseIdsError" effect="#{appBean.effectOutputText}" 
									rendered="#{!appBean.mfb.renderSDF}">
									<ice:message id="errdbID" for="dbID"></ice:message>
								</ice:panelGroup>
								
								<!-- provide molecular formula, e.g. C6H12O6 -->
								<ice:panelGroup id="lblMFSumFormula" panelTooltip="lblMFSumFormulaTooltip" rendered="#{!appBean.mfb.renderSDF}">
									<ice:outputLabel for="sumFormula" value="Molecular Formula:"></ice:outputLabel>
									<ice:panelTooltip id="lblMFSumFormulaTooltip">
		    							<f:facet id="facetMetfragMolFormulaHeader" name="header">
		    								<ice:outputText id="outputtextMetfragMolFormulaHeader"
		    									value="Molecular Formula"></ice:outputText>
		    							</f:facet>
		    							<f:facet id="facetMetfragMolFormulaBody" name="body">
		    								<ice:outputText id="outputtextMetfragMolFormulaBody" 
		    									value="Optionally provide one known molecular formula.
		    									An example would be C6H12O6."></ice:outputText>
		    							</f:facet>
	    							</ice:panelTooltip>
								</ice:panelGroup>
								<ice:inputText id="sumFormula" value="#{appBean.mfb.molecularFormula}" rendered="#{!appBean.mfb.renderSDF}"
									valueChangeListener="#{appBean.mfb.changeFormula}"></ice:inputText>
								<ice:panelGroup id="panelgroupMetfragSumFormulaError" 
									effect="#{appBean.effectOutputText}" rendered="#{!appBean.mfb.renderSDF}">
									<ice:message id="errsumFormula" for="sumFormula"></ice:message>
								</ice:panelGroup>
								
								<!-- specify the mass of the parent ion and adduct -->
								<ice:panelGroup id="lblMFParentIon" panelTooltip="lblMFParentIonTooltip" rendered="#{!appBean.mfb.renderSDF}">
									<ice:outputLabel id="outputlabelMetfragParentIon" for="parentIon" 
										value="Parent Ion:" style=""></ice:outputLabel>
									<ice:panelTooltip id="lblMFParentIonTooltip">
		    							<f:facet id="facetMetfragParentIonHeader" name="header">
		    								<ice:outputText id="outputtextMetfragParentIonHeader" value="Parent Ion"></ice:outputText>
		    							</f:facet>
		    							<f:facet id="facetMetfragParentIonBody" name="body">
		    								<ice:outputText id="outputtextMetfragParentIonBody" 
		    									value="Calculated mass of the parent ion. First provide the mass of the ion, 
		    									then select which type of adduct was formed in order to calculate the corresponding exact mass."/>
		    								<br/>
		    								<ice:outputLink id="fiehnAdductList"  target="_blank" style="text-decoration: underline;"
		    									value="http://fiehnlab.ucdavis.edu/staff/kind/Metabolomics/MS-Adduct-Calculator/">
		    									Adduct List from Fiehnlab
		    								</ice:outputLink>
		    							</f:facet>
	    							</ice:panelTooltip>
								</ice:panelGroup>
								<ice:panelGroup id="panelgroupMetfragParentIon" rendered="#{!appBean.mfb.renderSDF}">
									<ice:inputText id="parentIon" value="#{appBean.mfb.parentIon}" partialSubmit="true" required="true"									
										validatorMessage="Value is not between 10 and 10000.0" valueChangeListener="#{appBean.mfb.changeParentIon}"
										disabled="#{appBean.mfb.viaFormula}">
										<f:validator validatorId="numberValidator"/>
										<f:validateDoubleRange minimum="10.0" maximum="10000.0"/>
									</ice:inputText>
									<ice:selectOneMenu id="selectAdduct" valueChangeListener="#{appBean.mfb.changeAdduct}"
										value="#{appBean.mfb.selectedAdduct}" disabled="#{appBean.mfb.viaFormula}">
										<f:selectItems id="selectitemsMetfragAdductList" value="#{appBean.mfb.adductList}" var="adduct"
											itemLabel="#{adduct.label}" itemValue="#{adduct.value}"/>
									</ice:selectOneMenu>
								</ice:panelGroup>
								<ice:panelGroup id="panelgroupMetfragParentIonError" effect="#{appBean.effectOutputText}" 
									rendered="#{!appBean.mfb.renderSDF}">
									<ice:message id="errparentIon" for="parentIon"></ice:message>
								</ice:panelGroup>
								
								<!-- show the computed exact mass of the precursor molecule -->
								<ice:panelGroup id="lblMFExactMass" panelTooltip="lblMFExactMassTooltip" rendered="#{!appBean.mfb.renderSDF}">
									<ice:outputLabel id="outputlabelMetfragExactMass" for="exactMass" value="Exact Mass:" style=""></ice:outputLabel>
									<ice:panelTooltip id="lblMFExactMassTooltip">
		    							<f:facet id="facetMetfragExactMassHeader" name="header">
		    								<ice:outputText id="outputtextMetfragExactMassHeader" value="Exact Mass"></ice:outputText>
		    							</f:facet>
		    							<f:facet id="facetMetfragExactMassBody" name="body">
		    								<ice:outputText id="outputtextMetfragExactMassBody" 
		    									value="Required exact mass for candidate of interest. For metabolomic scope,
		    									it ranges from 1 to 10000."></ice:outputText>
		    							</f:facet>
	    							</ice:panelTooltip>
								</ice:panelGroup>
								<ice:inputText id="exactMass" value="#{appBean.mfb.exactMass}" partialSubmit="true" required="true"
									validatorMessage="Value is not between 10 and 10000.0" disabled="true" style="color: ForestGreen;"
									rendered="#{!appBean.mfb.renderSDF}">
<!--									effect="#{appBean.effectOutputText}"-->
									<f:validator validatorId="numberValidator"/>
									<f:validateDoubleRange minimum="10.0" maximum="10000.0"></f:validateDoubleRange>
								</ice:inputText>
								<ice:panelGroup id="panelgroupMetfragExactMassError" effect="#{appBean.effectOutputText}" rendered="#{!appBean.mfb.renderSDF}">
									<ice:message id="errexactMass" for="exactMass"></ice:message>
								</ice:panelGroup>
								
								<!-- limit the number of MetFrag results -->
								<ice:panelGroup id="lblMFLimit" panelTooltip="lblMFLimitTooltip" rendered="#{!appBean.mfb.renderSDF}">
									<ice:outputLabel id="outputlabelMetfragCandLimit" for="candLimit" value="Limit # of Structures:"></ice:outputLabel>
									<ice:panelTooltip id="lblMFLimitTooltip">
		    							<f:facet id="facetMetfragCandLimitHeader" name="header">
		    								<ice:outputText id="outputtextMetfragCandLimitHeader" 
		    									value="Limit # of Structures"></ice:outputText>
		    							</f:facet>
		    							<f:facet id="facetMetfragCandLimitBody" name="body">
		    								<ice:outputText id="outputtextMetfragCandLimitBody"  
		    									value="Required maximum value of candidates. The limit ranges from 1 to 10000."></ice:outputText>
		    							</f:facet>
	    							</ice:panelTooltip>
								</ice:panelGroup>
								<ice:inputText id="candLimit" value="#{appBean.mfb.limit}" rendered="#{!appBean.mfb.renderSDF}"
									validatorMessage="Please enter a number between 1 and 10000.">
									<f:validator validatorId="numberValidator"/>
									<f:validateLongRange minimum="1" maximum="10000" for="candLimit"></f:validateLongRange>
								</ice:inputText>
								<ice:panelGroup id="panelgroupMetfragCandLimitError" effect="#{appBean.effectOutputText}" rendered="#{!appBean.mfb.renderSDF}">
									<ice:message id="errcandLimit" for="candLimit"></ice:message>
								</ice:panelGroup>
								
								<!-- specify biological (C,H,N,O,P,S) compounds only or not -->
								<ice:panelGroup id="lblMFchnops" panelTooltip="lblMFchnopsTooltip" rendered="#{!appBean.mfb.renderSDF}">
									<ice:outputLabel id="outputlabelMetfragCHNOPS" for="chnopsOnly" value="C,H,N,O,P,S only?"></ice:outputLabel>
									<ice:panelTooltip id="lblMFchnopsTooltip">
										<f:facet id="facetMetfragCHNOPSHeader" name="header">
											<ice:outputText id="outputtextMetfragCHNOPSHeader" 
												value="Retrieve only biological compounds"></ice:outputText>
										</f:facet>
										<f:facet id="facetMetfragCHNOPSBody" name="body">
											<ice:outputText id="outputtextMetfragCHNOPSBody" 
												value="Specify if only compounds that contain C,H,N,O,P and S 
											are considered (check), or not (uncheck)."></ice:outputText>
										</f:facet>
									</ice:panelTooltip>
								</ice:panelGroup>
								<ice:selectBooleanCheckbox id="chnopsOnly" value="#{appBean.mfb.onlyCHNOPS}" rendered="#{!appBean.mfb.renderSDF}"/>
								<ice:panelGroup id="panelgroupMetfragCHNOPSOnlyError" effect="#{appBean.effectOutputText}" 
									rendered="#{!appBean.mfb.renderSDF}">
									<ice:message id="errchnopsOnly" for="chnopsOnly"></ice:message>
								</ice:panelGroup>
								
								<!-- specify search ppm parameter -->
								<ice:panelGroup id="lblMFSeachPPM" panelTooltip="lblMFSeachPPMTooltip" rendered="#{!appBean.mfb.renderSDF}">
									<ice:outputLabel id="outputlabelMetfragSearchPPM" for="searchppm" value="Search PPM:"></ice:outputLabel>
									<ice:panelTooltip id="lblMFSeachPPMTooltip">
		    							<f:facet id="facetMetfragSearchPPMHeader" name="header">
		    								<ice:outputText id="outputtextMetfragSearchPPMHeader" value="Search PPM"></ice:outputText>
		    							</f:facet>
		    							<f:facet id="facetMetfragSearchPPMBody" name="body">
		    								<ice:outputText id="outputtextMetfragSearchPPMBody" 
		    								value="Required deviation for exact mass lookup. 
		    								Usually, this value should not exceed 30 ppm as this would lead to much more candidates.
		    								The allowed range is between 0.0 and 100. This value depends on the mass 
		    								accuracy of the used MS device."></ice:outputText>
		    							</f:facet>
	    							</ice:panelTooltip>
								</ice:panelGroup>
								<ice:inputText id="searchppm" value="#{appBean.mfb.searchppm}" partialSubmit="true" required="true"
									validatorMessage="Value is not between 0 and 100.0" rendered="#{!appBean.mfb.renderSDF}">
									<f:validator validatorId="numberValidator"/>
									<f:validateDoubleRange minimum="0.0" maximum="100.0" for="searchppm"/>
								</ice:inputText>
								<ice:panelGroup id="panelgroupMetfragSearchPPMError" effect="#{appBean.effectOutputText}" 
									rendered="#{!appBean.mfb.renderSDF}">
									<ice:message id="errsearchppm" for="searchppm"></ice:message>
								</ice:panelGroup>
								
								<!-- specify mz abs parameter -->
								<ice:panelGroup id="lblMFMZabs" panelTooltip="lblMFMZabsTooltip">
									<ice:outputLabel id="outputlabelMetfragMzAbs" for="mzabs" value="mz abs:"></ice:outputLabel>
									<ice:panelTooltip id="lblMFMZabsTooltip">
		    							<f:facet id="facetMetfragMzAbsHeader" name="header">
		    								<ice:outputText id="outputtextMetfragMzAbsHeader" value="mz abs"></ice:outputText>
		    							</f:facet>
		    							<f:facet id="facetMetfragMzAbsBody" name="body">
		    								<ice:outputText id="outputtextMetfragMzAbsBody" 
		    								value="Required absolute deviation of fragment peaks that should be matched. 
		    								Usually, this value should be fairly small (less than 1). The allowed range is between 0.0 and 100.">
		    								</ice:outputText>
		    							</f:facet>
	    							</ice:panelTooltip>
								</ice:panelGroup>
								<ice:inputText id="mzabs" value="#{appBean.mfb.mzabs}" partialSubmit="true" required="true"
									validatorMessage="Value is not between 0 and 100.0">
									<f:validator validatorId="numberValidator"/>
									<f:validateDoubleRange minimum="0.0" maximum="100.0" for="mzabs"/>
								</ice:inputText>
								<ice:panelGroup id="panelgroupMetfragMzAbsError" effect="#{appBean.effectOutputText}">
									<ice:message id="errmzabs" for="mzabs"></ice:message>
								</ice:panelGroup>
								
								<!-- specify mz ppm parameter -->
								<ice:panelGroup id="lblMFMZppm" panelTooltip="lblMFMZppmTooltip">
									<ice:outputLabel id="outputlabelMetfragMzPPM" for="mzppm" value="mz ppm:"></ice:outputLabel>
									<ice:panelTooltip id="lblMFMZppmTooltip">
		    							<f:facet id="facetMetfragMzPPMHeader" name="header">
		    								<ice:outputText id="outputtextMetfragMzPPMHeader" value="mz ppm"></ice:outputText>
		    							</f:facet>
		    							<f:facet id="facetMetfragMzPPMBody" name="body">
		    								<ice:outputText id="outputtextMetfragMzPPMBody" 
		    								value="Required relative deviation of fragment peaks that should be matched. 
		    								Usually, this value should be fairly small (less than 30). The allowed range is between 0.0 and 100.
		    								This value depends on the mass accuracy of the used MS device.">
		    								</ice:outputText>
		    							</f:facet>
	    							</ice:panelTooltip>
								</ice:panelGroup>
								<ice:inputText id="mzppm" value="#{appBean.mfb.mzppm}" partialSubmit="true" required="true"
									validatorMessage="Value is not between 0 and 100.0">
									<f:validator validatorId="numberValidator"/>
									<f:validateDoubleRange minimum="0.0" maximum="100.0" for="mzppm"/>
								</ice:inputText>
								<ice:panelGroup id="panelgroupMetfragMzPPMError" effect="#{appBean.effectOutputText}">
									<ice:message id="errmzppm" for="mzppm"></ice:message>
								</ice:panelGroup>
							</ice:panelGrid>
							
				    	</ice:panelGroup>
			    	</div>
			    	
			    	<!-- MetFusion parameters -->
			    	<div id="fusionParams" style=" padding: 0 1em; border: 1px dashed silver; width: 30%; float: right;">
				    	<ice:panelGroup id="panelgroupMetfusionParameters">
				    		<ice:outputLabel id="outputlabelMetfusionParamters" value="MetFusion Parameters" 
				    			style="text-decoration: underline;"></ice:outputLabel>
				    		<br/>
				    		<ice:panelGrid id="panelgridMetfusionParameters" columns="2" 
				    			style="margin-left: 10px; margin-right: 10px;">
				    			<ice:panelGroup id="lblMetFusionCluster" panelTooltip="lblMetFusionClusterTooltip" rendered="false">
					    			<ice:outputLabel id="outputlabelMetfusionCluster" for="SlctClstr" value="Tanimoto Clustering:" style="line-height:200%"></ice:outputLabel>
					    			<ice:panelTooltip id="lblMetFusionClusterTooltip">
		    							<f:facet id="facetMetfusionCluterHeader" name="header">
		    								<ice:outputText id="outputtextMetfusionCluterHeader" 
		    									value="Tanimoto Clustering"></ice:outputText>
		    							</f:facet>
		    							<f:facet id="facetMetfusionCluterBody" name="body">
		    								<ice:outputText id="outputtextMetfusionCluterBody" 
		    									value="deprecated - Optionally choose if clustering should be 
		    									applied to results. As only clustered results are provided, this is redundant.">
		    								</ice:outputText>
		    							</f:facet>
	    							</ice:panelTooltip>
					    		</ice:panelGroup>
								<ice:selectBooleanCheckbox id="SlctClstr" partialSubmit="true" value="#{appBean.useClustering}" 
									disabled="true" rendered="false"/>
		    					
		    					<ice:panelGroup id="lblMetFusionFilter" panelTooltip="lblMetFusionFilterTooltip">
					    			<ice:outputLabel id="outputlabeMetfusionFilter" for="SlctFltr" value="Filter Unique:" style="line-height:200%"></ice:outputLabel>
					    			<ice:panelTooltip id="lblMetFusionFilterTooltip">
		    							<f:facet id="facetMetfusionFilterHeader" name="header">
		    								<ice:outputText id="outputtextMetfusionFilterHeader" 
		    									value="InChI-based Filtering"></ice:outputText>
		    							</f:facet>
		    							<f:facet id="facetMetfusionFilterBody" name="body">
		    								<ice:outputText id="outputtextMetfusionFilterBody" 
		    								value="Optionally choose if results shall be filtered. This step removes 
		    								steroeisomeric compounds from MetFrag and duplicate spectra from MassBank.">
		    								</ice:outputText>
		    							</f:facet>
	    							</ice:panelTooltip>
					    		</ice:panelGroup>
								<ice:selectBooleanCheckbox id="SlctFltr" partialSubmit="true" value="#{appBean.useInChIFiltering}"/>
		    					
		    					<ice:panelGroup id="lblMetFusionPeaks" panelTooltip="lblMetFusionPeaksTooltip">
		    						<ice:outputLabel id="outputlabelMetfusionPeaks" value="Peaks:"></ice:outputLabel>
		    						<ice:panelTooltip id="lblMetFusionPeaksTooltip">
		    							<f:facet id="facetMetfusionPeaksHeader" name="header">
		    								<ice:outputText id="outputtextetfusionPeaksHeader" value="Peaks"></ice:outputText>
		    							</f:facet>
		    							<f:facet id="facetMetfusionPeaksBody" name="body">
		    								<ice:outputText id="outputtextetfusionPeaksBody"
		    								value="Each peak and its intensity (separated by space/tab) one line: 
		    								[m/z] [intensity] e.g.: 119.051 467.616.">
		    								</ice:outputText>
		    							</f:facet>
	    							</ice:panelTooltip>
		    					</ice:panelGroup>
		    					<ice:inputTextarea id="allPeaks" value="#{appBean.inputSpectrum}"
				                               cols="20" rows="7" partialSubmit="true" required="true"
				                               style="width:280px;height:240px;overflow: auto;" immediate="false">
				            		<f:validator validatorId="spectrumValidator"/>
									<f:converter converterId="de.ipbhalle.metfusion.web.controller.validation.SpectrumConverter"/>
								</ice:inputTextarea>
	    					</ice:panelGrid>
	    					<ice:panelGroup id="panelgroupMetfusionPeaksError" effect="#{appBean.effectOutputText}">
	    						<ice:message id="errallPeaks" for="allPeaks" style="font-color: red;"></ice:message>
							</ice:panelGroup>
				    	</ice:panelGroup>
			    	</div>
			    	
			    	<div id="divMetfusionProgress" style=" padding: 0 1em; border: 1px dotted silver; width: 30%; float: right; margin-top: 5px;">
				    	<ice:panelGroup id="progressDatabase" effect="#{appBean.effect}" visible="false">
							<ice:outputProgress id="progressDatabaseSearch" value="#{appBean.genericDatabase.searchProgress}" 
								label="#{appBean.genericDatabase.databaseName} retrieval: #{appBean.genericDatabase.searchProgress}%" 
								labelComplete="#{appBean.genericDatabase.databaseName} retrieval done!"/>
							<ice:outputProgress id="progressFragmenterSearch" value="#{fragmenterBean.progress}" 
								label="MetFrag retrieval: #{fragmenterBean.progress}%" labelComplete="MetFrag retrieval done!"/>
						</ice:panelGroup>
						<ice:panelGroup id="panelgroupGlobalProgress">
<!--							<ice:commandButton value="Start" action="#{appBean.runThreadedVersion}" disabled="#{!appBean.enableStart}"/>-->
<!--							<ice:commandButton id="reset" value="Reset" actionListener="#{appBean.reset}"></ice:commandButton>-->
							<ice:outputProgress id="progressGlobal" value="#{appBean.percentProgressGlobal}" 
								label="MetFusion Progress: #{appBean.status} - #{appBean.percentProgressGlobal}%" labelComplete="Global done!"/>
							<ice:outputProgress indeterminate="true" label="running..." value="#{appBean.percentProgressGlobal}"/>
						</ice:panelGroup>
					</div>
			    </div>
			    	
			    	<!-- application control start and reset -->
			    	<div id="command" style="clear: both; float: left;">
			    		<h:commandButton id="commandButtonStart" value="Start" 
			    			action="#{appBean.runThreadedVersion}" disabled="#{!appBean.enableStart}"/>
<!--				    	<ice:commandButton id="start" value="Start" action="#{appBean.runBoth}"></ice:commandButton>-->
<!--				   actionListener="#{appBean.runBoth}" 	-->
<!--						<ice:commandButton value="Stop" action="#{appBean.stopExecution}" rendered="#{!appBean.enableStart}"/>-->
				    	<ice:commandButton id="reset" value="Reset" actionListener="#{appBean.reset}"></ice:commandButton>
				    	<ice:message id="emptyResults" for="start"/>
			    	</div>
			    	
			    	<!-- feedback admin login and editing -->
			    	<div id="feedbackAdmin">
						<ice:commandLink id="openFeedbackAdminForm" value="Feedback Admin" action="#{feedbackBean.openFeedbackAdminPopup}" 
							immediate="false" style="float: right; text-decoration: underline; color: silver;"/>	
						<ice:panelPopup id="popupAdminFeedback" modal="false" rendered="#{feedbackBean.feedbackAdminRendered}"
							autoCentre="true">
							<f:facet id="facetFeedbackHeader" name="header">
								<ice:outputText id="outputtextFeedbackHeader" value="MetFusion Feedback Admin"/>
								<ice:commandButton id="commandbuttonFeadbackHeader" image="images/close.png" 
									action="#{feedbackBean.closeFeedbackAdminPopup}" 
									immediate="false" style="float: right;"/>
							</f:facet>
							
							<f:facet id="facetFeedbackBody" name="body">
								<!-- this single outer panelGroup is required in order to render the content properly -->
								<ice:panelGroup id="panelgroupFeedbackWorkaround">
								<ice:panelGroup id="feedbackAdminLogin" rendered="#{!feedbackBean.authorized}">
									<ice:panelGrid id="panelgridFeedback" columns="2">
										<ice:outputLabel id="labelFeedbackAdminUser" value="Username:" for="textFeedbackAdminUser"/>
										<ice:inputText id="textFeedbackAdminUser" value="#{feedbackBean.providedName}"/>

										<ice:outputLabel id="labelFeedbackAdminPass" value="Password:" for="textFeedbackAdminPass"/>
										<ice:inputSecret id="textFeedbackAdminPass" value="#{feedbackBean.providedPass}" action="#{feedbackBean.loginAdmin}"/>

										<ice:commandButton id="buttonFeedbackAdminLogin" value="Login" action="#{feedbackBean.loginAdmin}"/>
										<ice:outputText id="errorFeedbackAdminLogin" value="#{feedbackBean.loginError}" style="color: red;"/>
									</ice:panelGrid>
								</ice:panelGroup>
								
								<ice:panelGroup id="feedbackAdminData" rendered="#{feedbackBean.authorized}">
									<ice:dataTable id="feedbackTable" value="#{feedbackBean.feedbackEntries}" var="entry"
										rendered="#{feedbackBean.authorized}" rows="10">
										<ice:column>
											<f:facet id="facetFeedbackDateHeader" name="header">
												Date
											</f:facet>
											#{entry.date}
										</ice:column>
										<ice:column>
											<f:facet id="facetFeedbackContactHeader" name="header">
												Contact
											</f:facet>
											#{entry.name}
											<br/>
											#{entry.email}
										</ice:column>
										<ice:column>
											<f:facet id="facetFeedbackCommentHeader" name="header">
												Comment
											</f:facet>
											#{entry.comment}
										</ice:column>
										<ice:column>
											<f:facet id="facetFeedbackAnsweredHeader" name="header">
												Answered
											</f:facet>
											#{entry.answered}
										</ice:column>
										<ice:column>
											<f:facet id="facetFeedbackFixedHeader" name="header">
												Fixed
											</f:facet>
											#{entry.fixed}
										</ice:column>
										<ice:column>
											<f:facet id="facetFeedbackActionsHeader" name="header">
												Actions
											</f:facet>
											<ice:commandLink id="commandlinkFeedbackShowValues" value="Show Values" 
												style="text-decoration: underline;"
												actionListener="#{feedbackBean.feedbackRowSelectionListener}">
												<f:attribute name="currentFeedbackEntry" value="#{entry}"/>
											</ice:commandLink>
										</ice:column>
									</ice:dataTable>
									
									<ice:dataPaginator id="feedbackTablePaginator" for="feedbackTable" fastStep="10"
						                         pageCountVar="pageCount" pageIndexVar="pageIndex" paginator="true" 
						                         paginatorMaxPages="9" rendered="#{feedbackBean.authorized}">
										<f:facet id="facetFeedbackTablePaginatorFirst" name="first" >
						                	<ice:graphicImage id="graphicImageFirst" url="#{msgs.xpDataPaginatorFirst}" style="border:none;"/>
						                </f:facet>
						                <f:facet id="facetFeedbackTablePaginatorLast" name="last">
						                	<ice:graphicImage id="graphicImageLast" url="#{msgs.xpDataPaginatorLast}" style="border:none;" />
						                </f:facet>
						                <f:facet id="facetFeedbackTablePaginatorPrevious" name="previous">
						                	<ice:graphicImage id="graphicImagePrevious" url="#{msgs.xpDataPaginatorPrevious}" style="border:none;" />
						                </f:facet>
						                <f:facet id="facetFeedbackTablePaginatorNext" name="next">
						                	<ice:graphicImage id="graphicImageNext" url="#{msgs.xpDataPaginatorNext}" style="border:none;" />
						                </f:facet>
						                <f:facet id="facetFeedbackTablePaginatorFastForward" name="fastforward">
						                	<ice:graphicImage id="graphicImageFastForward" url="#{msgs.xpDataPaginatorFastforward}" style="border:none;" />
						                </f:facet>
						                <f:facet id="facetFeedbackTablePaginatorFastRewind" name="fastrewind">
						                	<ice:graphicImage id="graphicImageFastRewind" url="#{msgs.xpDataPaginatorFastrewind}" style="border:none;" />
						                </f:facet>
									</ice:dataPaginator>
									
									<ice:commandButton id="commandbuttonLogout" value="Logout" action="#{feedbackBean.closeFeedbackAdminPopup}"/>
									<ice:outputText id="outputtextFeedbackNote" value="#{feedbackBean.adminNote}" style="color: LimeGreen; float: right;"
										rendered="#{feedbackBean.renderAdminNote}"/>
									<ice:outputText id="outputtextFeedbackNoteNot" value="#{feedbackBean.adminNote}" style="color: red; float: right;"
										rendered="#{!feedbackBean.renderAdminNote}"/>
								</ice:panelGroup>
								</ice:panelGroup>
							</f:facet>
						</ice:panelPopup>
					</div>
			    </ice:panelTab>
			    
			    <ice:panelTab id="paneltabQueryResults" label="Query Results" rendered="#{appBean.showTable}">
			    	<ice:selectOneRadio id="selectOneRadioResults" value="#{appBean.selectedResult}" partialSubmit="true" rendered="#{appBean.showTable}">
						<f:selectItem id="selectitemResultCluster" itemLabel="MetFusion Cluster" 
							itemValue="cluster" itemDisabled="#{!appBean.showClusterResults}"/>
						<f:selectItem id="selectitemResultFragmenter" itemLabel="Fragmenter List" 
							itemValue="fragmenter" itemDisabled="#{!appBean.showResultsFragmenter}"/>
						<f:selectItem id="selectitemResultDatabase" itemLabel="Database List" 
							itemValue="database" itemDisabled="#{!appBean.showResultsDatabase}"/>
						<f:selectItem id="selectitemResultUnused" itemLabel="Unused Database Entries" 
							itemValue="unused" itemDisabled="#{!appBean.genericDatabase.showNote}"/>
					</ice:selectOneRadio>
					
					<ice:panelGroup id="panelgroupResultsResource" rendered="#{appBean.createdResource}"
						style="background-color: MintCream; border: 1px solid ForestGreen;">
						<ice:panelGrid id="panelgridResultsResource" columns="2">
							<ice:outputText id="outputtextResultsResource" value="Export all results into Excel file:"/>
							<ice:outputResource id="outputResource" resource="#{appBean.outputResource}"
								label="Save results in Excel document." mimeType="application/vnd.ms-excel"
								fileName="#{appBean.outputResource.resourceName}" image="/images/icons/xls.png" 
								rendered="#{appBean.createdResource}"/>
							
						</ice:panelGrid>
    				</ice:panelGroup>
    				
    				<ice:panelGroup id="panelgroupResultsError" style="background-color: MistyRose; border: 1px solid DarkRed;"
							rendered="#{appBean.errorMessage.length() > 0}">
    					<ice:outputText id="outputtextResultsError" value="#{appBean.errorMessage}" style="margin: 10px;"/>
    				</ice:panelGroup>
      						
					<ice:panelStack id="panelstackSelectedResult" selectedPanel="#{appBean.selectedResult}">
						<ice:panelGroup id="cluster">
							<ice:panelGroup id="panelgroupResultCluster" style="background-color: MintCream; border: 1px solid ForestGreen;">
								<ice:panelGrid id="panelgridResultCluster" columns="2">
									<ice:outputText id="outputtextResultCluster" 
										value="or reranked results only into SD file:" rendered="#{appBean.createdResourceSDF}"/>
									<ice:outputResource id="outputResourceSDF" rendered="#{appBean.createdResourceSDF}"
										resource="#{appBean.outputResourceSDF}" label="Save reranked results in SD file." mimeType="text"
										fileName="#{appBean.outputResourceSDF.resourceName}" image="/images/icons/sdf.png"/>
								</ice:panelGrid>
							</ice:panelGroup>
						
							<ice:dataTable id="tableCluster" value="#{appBean.tanimotoClusters}" rendered="#{appBean.showClusterResults}" 
								var="entry" rows="20">
								<f:facet id="facetResultTableCluster" name="header">
									<ice:outputLabel id="outputlabelResultTableCluster"
										value="MetFusion - Tanimoto Clustering Ranking" />
								</f:facet>
								<!-- contract/expand column -->
								<ice:column id="columnTableClusterExpand">
									<ice:panelGroup id="panelgroupTableClusterExpand"
										styleClass="#{entry.indentStyleClass}">
										<!-- Render the expand/contract if there is an image -->
										<ice:commandLink id="commandlinkTableClusterExpand"
											actionListener="#{entry.toggleSubGroupAction}">
											<ice:graphicImage id="expandContractImage"
												value="#{entry.expandContractImage}"
												style="border: 0px solid;" />
										</ice:commandLink>
									</ice:panelGroup>
								</ice:column>
								<ice:column id="columnTableClusterPort">
									<f:facet id="facetColumnTableClusterPort" name="header">Port Name</f:facet>
										#{entry.port}
									</ice:column>
								<ice:column id="columnTableRecord">
									<f:facet id="facetColumnTableRecordHeader" name="header">Record ID</f:facet>
									<ice:outputLink id="linkOutClusterTableRecord" value="#{entry.url}" 
										target="_blank" style="text-decoration: underline;">
										<ice:outputText id="rowDataClusterTableRecord" value="#{entry.id}" nospan="true"/>
									</ice:outputLink>
			<!--						#{entry.id}-->
								</ice:column>
								<ice:column id="columnTableCompoundName">
									<f:facet id="facetColumnTableCompundNameHeader" name="header">Compound Name</f:facet>
									#{entry.name}
								</ice:column>
								<ice:column id="columnTableExactMass">
									<f:facet id="facetColumnTableExactMassHeader" name="header">Exact Mass</f:facet>
									<ice:outputText id="outputtextColumnSumFormula" 
										value="#{entry.sumFormula}" escape="false"></ice:outputText>
									<br/><br/>
									#{entry.exactMass}
								</ice:column>
								<ice:column id="columnTableStructure">
									<f:facet id="facetColumnTableStructureHeader" name="header">Structure</f:facet>
									<ice:graphicImage id="graphicimageColumnStructure" value="#{entry.imagePath}" alt="Structure"/>
								</ice:column>
								<ice:column id="columnTableScore">
									<f:facet id="facetColumnTableScoreHeader" name="header">Score</f:facet>
									<ice:outputText id="outputtextColumnScore" value="#{entry.score}">
										<f:convertNumber maxFractionDigits="3"/>
									</ice:outputText>
									<br/><br/>
									<ice:outputFormat id="outputformatColumnPeaks" value="Peaks explained: {0}">
										<f:param value="#{entry.matchingPeaks}"/>
									</ice:outputFormat>
								</ice:column>
								<ice:column id="columnTableIntegrationScore">
									<f:facet id="facetColumnTableIntegrationScoreHeader" name="header">Integration Score</f:facet>
									<ice:outputText id="outputtextColumnIntegrationScore" value="#{entry.resultScore}">
										<f:convertNumber maxFractionDigits="3"/>
									</ice:outputText>
<!--									<ice:graphicImage alt="Position change" url="#{entry.flag}" style="margin-left:3px; float: right;"/>-->
								</ice:column>
								<ice:column id="columnTableFragments">
									<f:facet id="facetColumnTableFragmentsHeader" name="header">Fragments</f:facet>
									<ice:outputLink id="outputlinkColumnFragments" value="#{entry.landingURL}" target="_blank" 
										style="text-decoration: underline;">
										<ice:outputText id="outputtextColumnFragments" value="Compute Fragments" nospan="true"/>
									</ice:outputLink>
								</ice:column>
							</ice:dataTable>
							
							<ice:panelGrid id="panelgridTableClusterPaginator" columns="1" 
								styleClass="scrollerTable2" columnClasses="standardTable_ColumnCentered" >
			 
						        <ice:dataPaginator id="scroll_1_cluster" for="tableCluster" fastStep="10"
						                         pageCountVar="pageCount" pageIndexVar="pageIndex"
						                         paginator="true" paginatorMaxPages="9" rendered="#{appBean.showClusterResults}" >
						                <f:facet id="facetTableClusterPaginatorFirst" name="first" >
						                	<ice:graphicImage id="graphicimageTableClusterPaginatorFirst"
						                		url="#{msgs.xpDataPaginatorFirst}" style="border:none;"/>
						                </f:facet>
						                <f:facet id="facetTableClusterPaginatorLast" name="last">
						                	<ice:graphicImage id="graphicimageTableClusterPaginatorLast"
						                		url="#{msgs.xpDataPaginatorLast}" style="border:none;" />
						                </f:facet>
						                <f:facet id="facetTableClusterPaginatorPrevious" name="previous">
						                	<ice:graphicImage id="graphicimageTableClusterPaginatorPrevious"
						                		url="#{msgs.xpDataPaginatorPrevious}" style="border:none;" />
						                </f:facet>
						                <f:facet id="facetTableClusterPaginatorNext" name="next">
						                	<ice:graphicImage id="graphicimageTableClusterPaginatorNext"
						                		url="#{msgs.xpDataPaginatorNext}" style="border:none;" />
						                </f:facet>
						                <f:facet id="facetTableClusterPaginatorFastForward" name="fastforward">
						                	<ice:graphicImage id="graphicimageTableClusterPaginatorFastForward"
						                		url="#{msgs.xpDataPaginatorFastforward}" style="border:none;" />
						                </f:facet>
						                <f:facet id="facetTableClusterPaginatorFastRewind" name="fastrewind">
						                	<ice:graphicImage id="graphicimageTableClusterPaginatorFastRewind"
						                		url="#{msgs.xpDataPaginatorFastrewind}" style="border:none;" />
						                </f:facet>
						        </ice:dataPaginator>
						 
						        <ice:dataPaginator id="scroll_2_cluster" for="tableCluster" rendered="#{appBean.showClusterResults}" 
						                        rowsCountVar="rowsCount" displayedRowsCountVar="displayedRowsCountVar"
						                        firstRowIndexVar="firstRowIndex" lastRowIndexVar="lastRowIndex"
						                        pageCountVar="pageCount" pageIndexVar="pageIndex">
						 
						                 <ice:outputFormat id="outputformatTableCluster" styleClass="standard"
						                 	value="{0} candidates found, displaying {1} candidates from {2} to {3}. Page {4} / {5}">
						                        <f:param value="#{rowsCount}" />
						                        <f:param value="#{displayedRowsCountVar}" />
						                        <f:param value="#{firstRowIndex}" />
						                        <f:param value="#{lastRowIndex}" />
						                        <f:param value="#{pageIndex}" />
						                        <f:param value="#{pageCount}" />
						                </ice:outputFormat>
						 
						        </ice:dataPaginator>
						 
						    </ice:panelGrid>
						</ice:panelGroup>
						
						<ice:panelGroup id="fragmenter">
							<ice:panelGroup id="panelgroupTableFragmenter" 
								style="background-color: MintCream; border: 1px solid ForestGreen;">
								<ice:panelGrid id="panelgridTableFragment" columns="2">
									<ice:outputText id="outputextTableFragmenterSDF" 
										value="or fragmenter results only into SD file:" rendered="#{appBean.createdResourceSDFFragmenter}"/>
									<ice:outputResource id="outputResourceSDFFragmenter" rendered="#{appBean.createdResourceSDFFragmenter}"
										resource="#{appBean.outputResourceSDFFragmenter}" label="Save reranked results in SD file." mimeType="text"
										fileName="#{appBean.outputResourceSDFFragmenter.resourceName}" image="/images/icons/sdf.png"/>
								</ice:panelGrid>
							</ice:panelGroup>
						
							<ice:dataTable id="fragmenterList" value="#{appBean.mfb.results}" 
								rendered="#{appBean.mfb.showResult}" var="entry" rows="20">
								<f:facet id="facetFragmenterListInfoHeader" name="header">
									<ice:outputText value="Original Candidate Ranking" />
								</f:facet>
								<ice:column id="columnFragmenterListPort">
									<f:facet id="facetFragmenterListPortHeader" name="header">Port Name</f:facet>
									#{entry.port}
								</ice:column>
								<ice:column id="columnFragmenterListRecord">
									<f:facet id="facetFragmenterListRecordHeader" name="header">Record ID</f:facet>
									<ice:outputLink id="linkOutFragmenterListRecord" value="#{entry.url}" target="_blank" 
										style="text-decoration: underline;">
										<ice:outputText id="rowDataFragmenterListRecord" value="#{entry.id}" nospan="true"/>
									</ice:outputLink>
								</ice:column>
								<ice:column id="columnFragmenterListCompoundName">
									<f:facet id="facetFragmenterListCompoundNameHeader" name="header">Compound Name</f:facet>
									#{entry.name}
<!--									<br/>-->
<!--									#{entry.smiles}-->
								</ice:column>
								<ice:column id="columnFragmenterListExactMass">
									<f:facet id="facetFragmenterListExactMassHeader" name="header">Exact Mass</f:facet>
									<ice:outputText value="#{entry.sumFormula}" escape="false"></ice:outputText>
									<br/><br/>
									#{entry.exactMass}
								</ice:column>
								<ice:column id="columnFragmenterListStructure">
									<f:facet id="facetFragmenterListStructureHeader" name="header">Structure</f:facet>
									<ice:graphicImage value="#{entry.imagePath}" alt="Structure"/>
								</ice:column>
								<ice:column id="columnFragmenterListScore">
									<f:facet id="facetFragmenterListScoreHeader" name="header">Score</f:facet>
									#{entry.score}
									<br/><br/>
									<ice:outputFormat value="Peaks explained: {0}">
										<f:param value="#{entry.matchingPeaks}"/>
									</ice:outputFormat>
								</ice:column>
								<ice:column id="columnFragmenterListFragments">
									<f:facet id="facetFragmenterListFragmentsHeader" name="header">Fragments</f:facet>
									<ice:outputLink value="#{entry.landingURL}" target="_blank" style="text-decoration: underline;">
										<ice:outputText value="Compute Fragments" nospan="true"/>
									</ice:outputLink>
								</ice:column>
							</ice:dataTable>
							
							<ice:panelGrid id="panelgridFragmenterListPaginator" columns="1" 
								styleClass="scrollerTable2" columnClasses="standardTable_ColumnCentered" >
						        <ice:dataPaginator id="scroll_1_fragmenter" for="fragmenterList" fastStep="10"
						                         pageCountVar="pageCount" pageIndexVar="pageIndex"
						                         paginator="true" paginatorMaxPages="9" rendered="#{appBean.mfb.showResult}">
						                <f:facet id="facetFragmenterListPaginatorFirst" name="first" >
						                         <ice:graphicImage id="graphicImageFragmenterListPaginatorFirst"
						                         	url="#{msgs.xpDataPaginatorFirst}" style="border:none;"/>
						                </f:facet>
						                <f:facet id="facetFragmenterListPaginatorLast" name="last">
						                        <ice:graphicImage id="graphicImageFragmenterListPaginatorLast"
						                        	url="#{msgs.xpDataPaginatorLast}" style="border:none;" />
						                </f:facet>
						                <f:facet id="facetFragmenterListPaginatorPrevious" name="previous">
						                        <ice:graphicImage id="graphicImageFragmenterListPaginatorPrevious"
						                        	url="#{msgs.xpDataPaginatorPrevious}" style="border:none;" />
						                </f:facet>
						                <f:facet id="facetFragmenterListPaginatorNext" name="next">
						                        <ice:graphicImage id="graphicImageFragmenterListPaginatorNext"
						                        	url="#{msgs.xpDataPaginatorNext}" style="border:none;" />
						                </f:facet>
						                <f:facet id="facetFragmenterListPaginatorFastForward" name="fastforward">
						                        <ice:graphicImage id="graphicImageFragmenterListPaginatorFastForward" 
						                        	url="#{msgs.xpDataPaginatorFastforward}" style="border:none;" />
						                </f:facet>
						                <f:facet id="facetFragmenterListPaginatorFastRewind" name="fastrewind">
						                        <ice:graphicImage id="graphicImageFragmenterListPaginatorFastRewind"
						                        	url="#{msgs.xpDataPaginatorFastrewind}" style="border:none;" />
						                </f:facet>
						        </ice:dataPaginator>
						 
						        <ice:dataPaginator id="scroll_2_fragmenter" for="fragmenterList" rendered="#{appBean.mfb.showResult}" 
						                        rowsCountVar="rowsCount" displayedRowsCountVar="displayedRowsCountVar"
						                        firstRowIndexVar="firstRowIndex" lastRowIndexVar="lastRowIndex"
						                        pageCountVar="pageCount" pageIndexVar="pageIndex">
						                 <ice:outputFormat id="outputformatFragmentListResultInfo" 
						                 	value="{0} candidates found, displaying {1} candidates from {2} to {3}. Page {4} / {5}" styleClass="standard" >
						                        <f:param value="#{rowsCount}" />
						                        <f:param value="#{displayedRowsCountVar}" />
						                        <f:param value="#{firstRowIndex}" />
						                        <f:param value="#{lastRowIndex}" />
						                        <f:param value="#{pageIndex}" />
						                        <f:param value="#{pageCount}" />
						                </ice:outputFormat>
						        </ice:dataPaginator>
						    </ice:panelGrid>
						</ice:panelGroup>
						
						<ice:panelGroup id="database">
							<ice:panelGroup id="panelgroupDatabase" style="background-color: MintCream; border: 1px solid ForestGreen;">
								<ice:panelGrid columns="2">
									<ice:outputText id="outputtextDatabaseResults" value="or database results only into SD file:" rendered="#{appBean.createdResourceSDFDatabase}"/>
									<ice:outputResource id="outputResourceSDFDatabase" rendered="#{appBean.createdResourceSDFDatabase}"
										resource="#{appBean.outputResourceSDFDatabase}" label="Save reranked results in SD file." mimeType="text"
										fileName="#{appBean.outputResourceSDFDatabase.resourceName}" image="/images/icons/sdf.png"/>
								</ice:panelGrid>
							</ice:panelGroup>
						
							<ice:dataTable id="databaseList" value="#{appBean.genericDatabase.results}"
								rendered="#{appBean.genericDatabase.showResult}" var="entry" rows="20">
								<f:facet id="facetDatabaseListHeader" name="header">
									<ice:outputText value="Original Database Ranking" />
								</f:facet>
								
								<ice:column id="columnDatabaseListPort">
									<f:facet id="facetDatabaseListPortHeader" name="header">Port Name</f:facet>
									#{entry.port}
								</ice:column>
								<ice:column id="columnDatabaseListRecord">
									<f:facet id="facetDatabaseListPortHeader" name="header">Record ID</f:facet>
									<ice:outputLink id="linkOutDatabaseListRecord" value="#{entry.url}" 
										target="_blank" style="text-decoration: underline;">
										<ice:outputText id="rowDataDatabaseListRecord" value="#{entry.id}" nospan="true"/>
									</ice:outputLink>
								</ice:column>
								<ice:column id="columnDatabaseListCompoundName">
									<f:facet id="facetDatabaseListCompoundNameHeader" name="header">Compound Name</f:facet>
									#{entry.name}
<!--									#{entry.smiles}-->
								</ice:column>
								<ice:column id="columnDatabaseListExactMass">
									<f:facet id="facetDatabaseListExactMassHeader" name="header">Exact Mass</f:facet>
									<ice:outputText id="outputtextColumnDatabaseListExactMass" 
										value="#{entry.sumFormula}" escape="false"></ice:outputText>
									<br/><br/>
									#{entry.exactMass}
								</ice:column>
								<ice:column id="columnDatabaseListStructure">
									<f:facet id="facetDatabaseListStructureHeader" name="header">Structure</f:facet>
									<ice:graphicImage id="graphicimageColumnDatabaseListStructure" 
										value="#{entry.imagePath}" alt="Structure"/>
								</ice:column>
								<ice:column id="columnDatabaseListScore">
									<f:facet id="facetDatabaseListScoreHeader" name="header">Score</f:facet>
									#{entry.score}
									<br/><br/>
									<ice:outputFormat id="outputformatColumnDatabaseListScore" 
										value="Peaks explained: {0}">
										<f:param value="#{entry.matchingPeaks}"/>
									</ice:outputFormat>
								</ice:column>
							</ice:dataTable>
							
							<ice:panelGrid id="panelgridDatabaseListPaginator" columns="1" 
								styleClass="scrollerTable2" columnClasses="standardTable_ColumnCentered" >
						        <ice:dataPaginator id="scroll_1_database" for="databaseList" fastStep="10"
						                         pageCountVar="pageCount" pageIndexVar="pageIndex"
						                         paginator="true" paginatorMaxPages="9" rendered="#{appBean.mfb.showResult}" >
						                <f:facet id="facetDatabaseListPaginatorFirst" name="first" >
						                         <ice:graphicImage id="graphicimageDatabaseListPaginatorFirst"
						                         	url="#{msgs.xpDataPaginatorFirst}" style="border:none;"/>
						                </f:facet>
						                <f:facet id="facetDatabaseListPaginatorLast" name="last">
						                        <ice:graphicImage id="graphicimageDatabaseListPaginatorLast"
						                        	url="#{msgs.xpDataPaginatorLast}" style="border:none;" />
						                </f:facet>
						                <f:facet id="facetDatabaseListPaginatorPrevious" name="previous">
						                        <ice:graphicImage id="graphicimageDatabaseListPaginatorPrevious"
						                        	url="xmlhttp/css/xp/css-images/arrow-previous.gif" style="border:none;" />
						                </f:facet>
						                <f:facet id="facetDatabaseListPaginatorNext" name="next">
						                        <ice:graphicImage id="graphicimageDatabaseListPaginatorNext" 
						                        	url="xmlhttp/css/xp/css-images/arrow-next.gif" style="border:none;" />
						                </f:facet>
						                <f:facet id="facetDatabaseListPaginatorFastForward" name="fastforward">
						                        <ice:graphicImage id="graphicimageDatabaseListPaginatorFastForward"
						                        	url="xmlhttp/css/xp/css-images/arrow-ff.gif" style="border:none;" />
						                </f:facet>
						                <f:facet id="facetDatabaseListPaginatorFastRewind" name="fastrewind">
						                        <ice:graphicImage id="graphicimageDatabaseListPaginatorFastRewind"
						                        	url="xmlhttp/css/xp/css-images/arrow-fr.gif" style="border:none;" />
						                </f:facet>
						        </ice:dataPaginator>
						 
						        <ice:dataPaginator id="scroll_2_database" for="databaseList" rendered="#{appBean.mfb.showResult}" 
						                        rowsCountVar="rowsCount" displayedRowsCountVar="displayedRowsCountVar"
						                        firstRowIndexVar="firstRowIndex" lastRowIndexVar="lastRowIndex"
						                        pageCountVar="pageCount" pageIndexVar="pageIndex">
						                 <ice:outputFormat id="outputformatDatabaseListResultInfo" 
						                 	value="{0} candidates found, displaying {1} candidates from {2} to {3}. Page {4} / {5}" styleClass="standard" >
						                        <f:param value="#{rowsCount}" />
						                        <f:param value="#{displayedRowsCountVar}" />
						                        <f:param value="#{firstRowIndex}" />
						                        <f:param value="#{lastRowIndex}" />
						                        <f:param value="#{pageIndex}" />
						                        <f:param value="#{pageCount}" />
						                </ice:outputFormat>
						        </ice:dataPaginator>
						    </ice:panelGrid>
						</ice:panelGroup>
						
						<ice:panelGroup id="unused">
							<ice:panelGroup id="panelgroupUnusedEntries" style="background-color: MintCream; border: 1px solid ForestGreen;">
								<ice:panelGrid id="panelgridUnusedTop" columns="2">
									<ice:outputText id="outputtextUnusedSDF" value="or unused database entries only into SD file:" 
										rendered="#{appBean.createdResourceSDFUnused}"/>
									<ice:outputResource id="outputResourceSDFUnused" rendered="#{appBean.createdResourceSDFUnused}"
										resource="#{appBean.outputResourceSDFUnused}" label="Save reranked results in SD file." mimeType="text"
										fileName="#{appBean.outputResourceSDFUnused.resourceName}" image="/images/icons/sdf.png"/>
								</ice:panelGrid>
							</ice:panelGroup>
						
			    			<ice:dataTable id="unusedDatabaseEntries" value="#{appBean.genericDatabase.unused}" var="entry" rows="20">
			    				<f:facet id="facetUnusedDatabaseColumnHeader" name="header">
			    					<ice:outputText id="outputtextUnusedDatabaseEntries" 
			    						value="Unused #{appBean.genericDatabase.databaseName} Entries"/>
			    				</f:facet>
			    				<ice:column id="columnDatabaseUnusedPort">
									<f:facet id="facetUnusedDatabasePortHeader" name="header">Port Name</f:facet>
									#{entry.port}
								</ice:column>
								<ice:column id="columnDatabaseUnusedRecord">
									<f:facet id="facetUnusedDatabasePortHeader" name="header">Record ID</f:facet>
									<ice:outputLink id="linkOutUnusedListRecord" value="#{entry.url}" 
										target="_blank" style="text-decoration: underline;">
										<ice:outputText id="rowDataUnusedListRecord" value="#{entry.id}" nospan="true"/>
									</ice:outputLink>
								</ice:column>
								<ice:column id="columnDatabaseUnusedCompoundName">
									<f:facet id="facetUnusedDatabaseCompoundNameHeader" name="header">Compound Name</f:facet>
									#{entry.name}
<!--									#{entry.smiles}-->
								</ice:column>
								<ice:column id="columnDatabaseUnusedExactMass">
									<f:facet id="facetUnusedDatabaseExactMassHeader" name="header">Exact Mass</f:facet>
									<ice:outputText id="outputtextUnusedDatabaseExactMass"
										value="#{entry.sumFormula}" escape="false"></ice:outputText>
									<br/><br/>
									#{entry.exactMass}
								</ice:column>
								<ice:column id="columnDatabaseUnusedStructure">
									<f:facet id="facetUnusedDatabaseStructureHeader" name="header">Structure</f:facet>
									<ice:graphicImage id="graphicimageUnusedDatabaseColumnStructure"
										value="#{entry.imagePath}" alt="Structure"/>
								</ice:column>
								<ice:column id="columnDatabaseUnusedScore">
									<f:facet id="facetUnusedDatabaseScoreHeader" name="header">Score</f:facet>
									#{entry.score}
									<br/><br/>
									<ice:outputFormat idf="outputformatUnusedDatabaseColumnScore"
										value="Peaks explained: {0}">
										<f:param value="#{entry.matchingPeaks}"/>
									</ice:outputFormat>
								</ice:column>
			    			</ice:dataTable>
			    			
			    			<ice:panelGrid id="panelgridDatabaseUnusedPaginator" columns="1" styleClass="scrollerTable2" columnClasses="standardTable_ColumnCentered" >
						        <ice:dataPaginator id="scroll_1_unused" for="unusedDatabaseEntries" fastStep="10"
						                         pageCountVar="pageCount" pageIndexVar="pageIndex"
						                         paginator="true" paginatorMaxPages="9" rendered="#{appBean.mfb.showResult}" >
						                <f:facet id="facetDatabaseUnusedPaginatorFirst" name="first" >
						                         <ice:graphicImage id="graphicimageDatabaseUnusedPaginatorFirst" 
						                         	url="#{msgs.xpDataPaginatorFirst}" style="border:none;"/>
						                </f:facet>
						                <f:facet id="facetDatabaseUnusedPaginatorLast" name="last">
						                        <ice:graphicImage id="graphicimageDatabaseUnusedPaginatorLast"
						                        	url="#{msgs.xpDataPaginatorLast}" style="border:none;" />
						                </f:facet>
						                <f:facet id="facetDatabaseUnusedPaginatorPrevious" name="previous">
						                        <ice:graphicImage id="graphicimageDatabaseUnusedPaginatorPrevious"
						                        	url="xmlhttp/css/xp/css-images/arrow-previous.gif" style="border:none;" />
						                </f:facet>
						                <f:facet id="facetDatabaseUnusedPaginatorNext" name="next">
						                        <ice:graphicImage id="graphicimageDatabaseUnusedPaginatorNext"
						                        	url="xmlhttp/css/xp/css-images/arrow-next.gif" style="border:none;" />
						                </f:facet>
						                <f:facet id="facetDatabaseUnusedPaginatorFastForward" name="fastforward">
						                        <ice:graphicImage id="graphicimageDatabaseUnusedPaginatorFastForward"
						                        	url="xmlhttp/css/xp/css-images/arrow-ff.gif" style="border:none;" />
						                </f:facet>
						                <f:facet id="facetDatabaseUnusedPaginatorFastRewind" name="fastrewind">
						                        <ice:graphicImage id="graphicimageDatabaseUnusedPaginatorFastRewind"
						                        	url="xmlhttp/css/xp/css-images/arrow-fr.gif" style="border:none;" />
						                </f:facet>
						        </ice:dataPaginator>
						 
						        <ice:dataPaginator id="scroll_2_unused" for="unusedDatabaseEntries" rendered="#{appBean.mfb.showResult}" 
						                        rowsCountVar="rowsCount" displayedRowsCountVar="displayedRowsCountVar"
						                        firstRowIndexVar="firstRowIndex" lastRowIndexVar="lastRowIndex"
						                        pageCountVar="pageCount" pageIndexVar="pageIndex">
						                 <ice:outputFormat id="outputformatDatabaseUnusedEntries" 
						                 	value="{0} results unused, displaying {1} results from {2} to {3}. Page {4} / {5}" styleClass="standard" >
						                        <f:param value="#{rowsCount}" />
						                        <f:param value="#{displayedRowsCountVar}" />
						                        <f:param value="#{firstRowIndex}" />
						                        <f:param value="#{lastRowIndex}" />
						                        <f:param value="#{pageIndex}" />
						                        <f:param value="#{pageCount}" />
						                </ice:outputFormat>
						        </ice:dataPaginator>
						    </ice:panelGrid>
						</ice:panelGroup>
					</ice:panelStack>
					
			    	
				</ice:panelTab>
				
			    <ice:panelTab id="paneltablSimilarityMatrix" label="Similarity Matrix" rendered="#{appBean.showResultTable}">
			    	<!-- Controls to change stacking panels -->
			    	<ice:panelGroup id="panelgroupSimilarityMatrix" style="width:40%; border: 1px solid silver;">
				    	<ice:selectOneRadio id="mainRadio" value="#{appBean.selectedMatrixPanel}"
	                    		partialSubmit="true" accesskey="S">
			                <f:selectItem id="selectItemOrigMatrix"
			                        itemValue="origSimMatrix"
			                        itemLabel="Original Similarity Matrix"/>
			                <f:selectItem id="selectItemNewMatrix"
			                        itemValue="newSimMatrix"
			                        itemLabel="Reranked Similarity Matrix"/>
			            </ice:selectOneRadio>
			    	</ice:panelGroup>
			    	
			    	<ice:panelStack id="stackingMatrices" selectedPanel="#{appBean.selectedMatrixPanel}">
			    		<!-- original similarity matrix -->
						<ice:panelGroup id="origSimMatrix" styleClass="exampleBox columnsTableContainer" rendered="#{appBean.genericDatabase.showResult}">
							<div id="divOrigSimMatrix" style="width:1400px; overflow:auto;">
							<!-- dataTable with columns component -->
							<ice:dataTable id="dataTbl" var="item" rendered="#{appBean.genericDatabase.showResult}"
								value="#{appBean.colorMatrix.rowDataModel}"
								columnClasses="columnsColumn" rows="20" style="padding:0;">
					
								<ice:column id="columnOrigSimMatrixHeader">
									<f:facet id="facetColumnOrigSimMatrixHeader" name="header">
										<ice:outputText id="outputTextOrigSimMatrixHeader"
											value="MetFrag \ #{appBean.genericDatabase.databaseName} Compounds"/>
									</f:facet>
									<ice:panelGroup id="panelgroupOrigSimMatrixHeader"
										style="text-align: center; white-space: nowrap;" panelTooltip="candidateTooltip">
										<ice:outputLink id="linkOutSimMatrixResultUrl" target="_blank"
											value="#{appBean.mfb.results[item].url}">
											<ice:outputText id="candidate"
												value="#{appBean.mfb.results[item].id}"/>
										</ice:outputLink>
									</ice:panelGroup>
									<ice:panelTooltip id="candidateTooltip">
										<f:facet id="facetOrigSimMatrixCandidateTooltipHeader" name="header">
											<ice:outputText id="outputtextOrigSimMatrixCandidateTooltipHeader" 
												value="#{appBean.mfb.results[item].name}"/>
										</f:facet>
										<f:facet id="facetOrigSimMatrixCandidateTooltipBody" name="body">
											<ice:panelGrid id="panelgridOrigSimMatrixCandidateTooltip" columns="2">
												<ice:graphicImage id="graphicimageOrigSimMatrixCandidateTooltipStructure" 
													alt="compound image" url="#{appBean.mfb.results[item].imagePath}"/>
												<ice:panelGroup id="panelgroupOrigSimMatrixCandidateTooltipScores" 
													style="margin-left: 5px; border: 1px solid silver; padding: 5px;">
													<ice:panelGrid id="panelgridOrigSimMatrixCandidateTooltipScores" columns="2">
														<ice:outputLabel id="lblMtrxRankOld" for="txtMtrxRankOld" value="Tied Rank:"/>
														<ice:outputText id="txtMtrxRankOld" value="#{appBean.mfb.results[item].tiedRank}"/>
														<ice:outputLabel id="lblMtrxScoreOld" for="txtMtrxScoreOld" value="MetFrag Score:"/>
														<ice:outputText id="txtMtrxScoreOld" value="#{appBean.mfb.results[item].score}"/>
													</ice:panelGrid>
												</ice:panelGroup>
											</ice:panelGrid>
										</f:facet>
									</ice:panelTooltip>
								</ice:column>
	
								<ice:columns id="columnDataModel"
									value="#{appBean.colorMatrix.columnDataModel}" var="column">
									<f:facet id="facetColumnDataModelHeader" name="header">
										<ice:panelGroup id="panelgroupColumnDataModel" 
											style="text-align: center; white-space: nowrap;">
											<ice:outputLink id="linkOutColorMatrx"
												value="#{appBean.colorMatrix.columnDataModel.rowData.url}"
												target="_blank">
												<ice:outputText id="rowDataColorMatrix"
													value="#{appBean.colorMatrix.columnDataModel.rowData.id}"
													nospan="true" />
											</ice:outputLink>
										</ice:panelGroup>
									</f:facet>
									
									<!-- display the table cell values-->
									<ice:panelGroup id="panelgroupColumnDataModelCellValues"
										style="text-align: center; white-space: nowrap;">
										<ice:outputText id="cellValue"
											value="#{appBean.colorMatrix.cellValue.valueShort}"
											style="background-color:#{appBean.colorMatrix.cellValue.color}; padding: 2px;" />
									</ice:panelGroup>
								</ice:columns>
							</ice:dataTable>
							</div>
							<ice:dataPaginator id="scroll_1_tan" for="dataTbl" fastStep="10"
								pageCountVar="pageCount" pageIndexVar="pageIndex"
								paginator="true" paginatorMaxPages="9" rendered="#{appBean.mfb.showResult}">
								<f:facet id="facetOrigSimMatrixPaginatorFirst" name="first">
									<ice:graphicImage id="graphicimageOrigSimMatrixPaginatorFirst"
										 url="#{msgs.xpDataPaginatorFirst}" style="border:none;"/>
								</f:facet>
								<f:facet id="facetOrigSimMatrixPaginatorLast" name="last">
									<ice:graphicImage id="graphicimageOrigSimMatrixPaginatorLast"
										url="#{msgs.xpDataPaginatorLast}" style="border:none;"/>
								</f:facet>
								<f:facet id="facetOrigSimMatrixPaginatorPrevious" name="previous">
									<ice:graphicImage id="graphicimageOrigSimMatrixPaginatorPrevious"
										url="#{msgs.xpDataPaginatorPrevious}"	style="border:none;"/>
								</f:facet>
								<f:facet id="facetOrigSimMatrixPaginatorNext" name="next">
									<ice:graphicImage id="graphicimageOrigSimMatrixPaginatorNext"
										url="#{msgs.xpDataPaginatorNext}"	style="border:none;"/>
								</f:facet>
								<f:facet id="facetOrigSimMatrixPaginatorFastForward" name="fastforward">
									<ice:graphicImage id="graphicimageOrigSimMatrixPaginatorFastForward"
										url="#{msgs.xpDataPaginatorFastforward}" style="border:none;"/>
								</f:facet>
								<f:facet id="facetOrigSimMatrixPaginatorFastRewind" name="fastrewind">
									<ice:graphicImage id="graphicimageOrigSimMatrixPaginatorFastRewind"
										url="#{msgs.xpDataPaginatorFastrewind}" style="border:none;"/>
								</f:facet>
							</ice:dataPaginator>
							<ice:dataPaginator id="scroll_2_tan" for="dataTbl" rendered="#{appBean.mfb.showResult}" 
		                        rowsCountVar="rowsCount" displayedRowsCountVar="displayedRowsCountVar"
		                        firstRowIndexVar="firstRowIndex" lastRowIndexVar="lastRowIndex"
		                        pageCountVar="pageCount" pageIndexVar="pageIndex">
				                 <ice:outputFormat id="outputformaOrigSimMatrixPaginatorInfo" 
				                 	value="{0} candidates found, displaying {1} candidates from {2} to {3}. Page {4} / {5}" 
				                 	styleClass="standard" >
			                        <f:param value="#{rowsCount}" />
			                        <f:param value="#{displayedRowsCountVar}" />
			                        <f:param value="#{firstRowIndex}" />
			                        <f:param value="#{lastRowIndex}" />
			                        <f:param value="#{pageIndex}" />
			                        <f:param value="#{pageCount}" />
				                </ice:outputFormat>
					        </ice:dataPaginator>
			    		</ice:panelGroup>
			    		
			    		<!-- newly computed MetFusion Tanimoto similarity matrix -->
			    		<ice:panelGroup id="newSimMatrix">
								<div id="divNewSimMatrix" style="width:1400px; overflow:auto;">
								<!-- dataTable with columns component -->
								<ice:dataTable id="dataTbl2" var="item" rendered="#{appBean.mfb.showResult}"
									value="#{appBean.colorMatrixAfter.rowDataModel}"
									columnClasses="columnsColumn" rows="20" style="padding:0;">
						
									<ice:column id="columnNewSimMatrixHeader">
										<f:facet id="facetNewSimMatrixHeader" name="header">
											<ice:outputText id="outputtextNewSimMatrixHeader" 
												value="MetFrag \ #{appBean.genericDatabase.databaseName} Compounds"/>
										</f:facet>
										<ice:panelGroup id="panelgroupNewSimMatrixHeader" 
											style="text-align: center; white-space: nowrap;" panelTooltip="candidateTooltipNewSimMatrix">
											<ice:outputLink id="linkOutColorMatrixAfter" target="_blank"
												value="#{appBean.secondOrder[item].url}">
												<ice:outputText id="candidate"
													value="#{appBean.secondOrder[item].id}"/>
											</ice:outputLink>
										</ice:panelGroup>
										<ice:panelTooltip id="candidateTooltipNewSimMatrix">
												<f:facet id="facetNewSimMatrixTooltipHeader" name="header">
													<ice:outputText id="outputtextNewSimMatrixTooltipHeader"
														value="#{appBean.secondOrder[item].name}"/>
												</f:facet>
												<f:facet id="facetNewSimMatrixTooltipBody" name="body">
													<ice:panelGrid id="panelgridNewSimMatrixTooltip" columns="2">
														<ice:graphicImage id="graphicimageNewSimMatrixTooltip" 
															alt="compound image" url="#{appBean.secondOrder[item].imagePath}"/>
														<ice:panelGroup id="panelgroupNewSimMatrixTooltipScores" 
															style="margin-left: 5px; border: 1px solid silver; padding: 5px;">
															<ice:panelGrid id="panelgridNewSimMatrixScores" columns="2">
																<ice:outputLabel id="lblMtrxRankNew" for="txtMtrxRankNew" value="Tied Rank:"/>
																<ice:outputText id="txtMtrxRankNew" value="#{appBean.secondOrder[item].tiedRank}"/>
																<ice:outputLabel id="lblMtrxScoreNew" for="txtMtrxScoreNew" value="MetFusion Score:"/>
																<ice:outputText id="txtMtrxScoreNew" value="#{appBean.secondOrder[item].resultScore}"/>
															</ice:panelGrid>
														</ice:panelGroup>
													</ice:panelGrid>
												</f:facet>
											</ice:panelTooltip>
									</ice:column>
		
									<ice:columns id="columnDataModel2"
										value="#{appBean.colorMatrixAfter.columnDataModel}" var="column">
										<f:facet id="facetNewSimMatrixColumnHeader" name="header">
											<ice:panelGroup id="panelgroupNewSimMatrixColumn">
												<ice:outputLink id="linkOutColorMatrixModel2"
													value="#{appBean.colorMatrixAfter.columnDataModel.rowData.url}"
													target="_blank">
													<ice:outputText id="rowDataColorMatrixModel2"
														value="#{appBean.colorMatrixAfter.columnDataModel.rowData.id}"
														nospan="true" />
												</ice:outputLink>
											</ice:panelGroup>
										</f:facet>
										<!-- display the table cell values-->
										<ice:panelGroup id="panelgroupNewSimMatrixCellValues" 
											style="text-align: center; white-space: nowrap;">
											<ice:outputText id="cellValue"
												value="#{appBean.colorMatrixAfter.cellValue.valueShort}"
												style="background-color:#{appBean.colorMatrixAfter.cellValue.color}; padding: 2px;" />
										</ice:panelGroup>
									</ice:columns>
								</ice:dataTable>
								</div>
								<ice:dataPaginator id="scroll_1_tan2" for="dataTbl2" fastStep="10"
									pageCountVar="pageCount" pageIndexVar="pageIndex"
									paginator="true" paginatorMaxPages="9" rendered="#{appBean.mfb.showResult}">
									<f:facet id="facetNewSimMatrixPaginatorFirst" name="first">
										<ice:graphicImage id="graphicimageNewSimMatrixPaginatorFirst"
											url="#{msgs.xpDataPaginatorFirst}" style="border:none;"/>
									</f:facet>
									<f:facet id="facetNewSimMatrixPaginatorLast" name="last">
										<ice:graphicImage id="graphicimageNewSimMatrixPaginatorLast"
											url="#{msgs.xpDataPaginatorLast}" style="border:none;"/>
									</f:facet>
									<f:facet id="facetNewSimMatrixPaginatorPrevious" name="previous">
										<ice:graphicImage id="graphicimageNewSimMatrixPaginatorPrevious"
											url="#{msgs.xpDataPaginatorPrevious}"	style="border:none;"/>
									</f:facet>
									<f:facet id="facetNewSimMatrixPaginatorNext" name="next">
										<ice:graphicImage id="graphicimageNewSimMatrixPaginatorNext"
											url="#{msgs.xpDataPaginatorNext}"	style="border:none;"/>
									</f:facet>
									<f:facet id="facetNewSimMatrixPaginatorFastForward" name="fastforward">
										<ice:graphicImage id="graphicimageNewSimMatrixPaginatorFastForward"
											url="#{msgs.xpDataPaginatorFastforward}" style="border:none;"/>
									</f:facet>
									<f:facet id="facetNewSimMatrixPaginatorFastRewind" name="fastrewind">
										<ice:graphicImage id="graphicimageNewSimMatrixPaginatorFastRewind"
											url="#{msgs.xpDataPaginatorFastrewind}" style="border:none;"/>
									</f:facet>
								</ice:dataPaginator>
								<ice:dataPaginator id="scroll_2_tan2" for="dataTbl2" rendered="#{appBean.mfb.showResult}" 
			                        rowsCountVar="rowsCount" displayedRowsCountVar="displayedRowsCountVar"
			                        firstRowIndexVar="firstRowIndex" lastRowIndexVar="lastRowIndex"
			                        pageCountVar="pageCount" pageIndexVar="pageIndex">
				                	<ice:outputFormat id="outputformatNewSimMatrixPaginatorInfo"
				                		value="{0} candidates found, displaying {1} candidates from {2} to {3}. Page {4} / {5}" 
					                 	styleClass="standard" >
				                        <f:param value="#{rowsCount}" />
				                        <f:param value="#{displayedRowsCountVar}" />
				                        <f:param value="#{firstRowIndex}" />
				                        <f:param value="#{lastRowIndex}" />
				                        <f:param value="#{pageIndex}" />
				                        <f:param value="#{pageCount}" />
				                	</ice:outputFormat>
					        </ice:dataPaginator>
			    		</ice:panelGroup>
			    	</ice:panelStack>
			    </ice:panelTab>
			    
			    <ice:panelTab id="panelTabError" label="Error/Log" 
			    	rendered="#{!(appBean.errorMessage.length() == 0)} | #{appBean.genericDatabase.showNote}">
			    	<ice:panelGroup id="panelgroupTabErrorMessage">
			    		<ice:outputText	id="outputtextTabErrorMessage" 
			    		value="#{appBean.errorMessage}" rendered="#{!(appBean.errorMessage.length() == 0)}"></ice:outputText>
			    	</ice:panelGroup>
			    	<ice:panelGroup id="panelgroupTabErrorNote">
			    		<ice:outputText id="outputtextTabErrorNote" 
			    		value="#{appBean.genericDatabase.missingEntriesNote}" rendered="#{appBean.genericDatabase.showNote}"></ice:outputText>
			    	</ice:panelGroup>
			    </ice:panelTab>
			    
			    <ice:panelTab id="paneltabInformation" label="Information">
			    	<ice:panelGrid id="panelgridInformation" columns="4">
	    				<ice:outputLink id="outputlinkInformationMetFusion" 
	    					value="http://msbi.ipb-halle.de/MetFusion/" title="MetFusion" 
	    					style="margin: 20px;" target="_blank">
							<img alt="MetFusion" class="iceGphImg" id="homelogo" src="images/appLogo.png"/>
						</ice:outputLink>
						<ice:outputLink id="outputlinkInformationMetFrag"  
							value="http://msbi.ipb-halle.de/MetFrag/" title="MetFrag" 
							style="margin: 20px;" target="_blank">
							<img alt="MetFrag" class="iceGphImg" id="homelogoMetFrag" src="images/metfrag_logo.png"/>
						</ice:outputLink>
						<ice:outputLink id="outputlinkInformationMassBank"  
							value="http://msbi.ipb-halle.de/MassBank/" title="MassBank" 
							style="margin: 20px;" target="_blank">
							<img alt="MassBank" class="iceGphImg" id="homelogoMassBank" src="images/massbank_logo.png"/>
						</ice:outputLink>
						<ice:outputLink id="outputlinkInformationMetlin" 
							value="http://metlin.scripps.edu/" title="Metlin" 
							style="margin: 20px;" target="_blank">
							<img alt="Metlin" class="iceGphImg" id="homelogoMetlin" src="images/metlin_logo.png"/>
						</ice:outputLink>
					</ice:panelGrid>
			    	<ice:panelGroup id="panelgroupInformation">
			    		<ice:panelCollapsible id="panelCollapsilbeInformation" expanded="true">
			    			<f:facet id="facetPanelCollapsilbeInformationHeader" name="header">
			    				<ice:panelGroup id="panelgrouppanelCollapsilbeInformation">
			    					<ice:outputText id="outputtextCollapsilbeInformationNews" value="News"></ice:outputText>
			    				</ice:panelGroup>
			    			</f:facet>
			    			<ice:panelGroup id="pnlGrpNews">
			    				Welcome to <b>MetFusion</b>, an approach to combine the knowledge from spectral databases like 
								<a href="http://www.massbank.jp">MassBank</a> with the multitude of candidates generated
								by fragmenters such as <a href="http://msbi.ipb-halle.de/MetFrag">MetFrag</a>.
								<br/>
								In order to do so, MS2 spectrum information is used to query MassBank and to provide
								fragments for the combinatorical fragmentation to generate candidates that match this
								specific fragmentation pattern.
								<br/>
								Combining both results is done via chemical similarity in terms of the Tanimoto coefficient.
								Using this score in addition to the result scores from MassBank (spectrum similiarity) and
								MetFrag (fragment matching) is now combined and used to rerank the list of fragmenter 
								candidates. This approach shows an improved rank of the correct candidate compared to MetFrag. 
								<hr/>
								<b>News:</b><br/>
								<ul>
								 <li>September 2012: MetFusion provides the option to filter the result lists of MetFrag and MassBank and 
								 	 leave out duplicates. This step improves the ranking, but is optional. MassBank elements not used are
								 	 available for further inspection in the <em>Unused Database Entries</em> list.
								 </li>
								 <li>August 2012: Added Metlin database as another source of high-quality MS/MS spectra.
								 </li>
								</ul> 
			    			</ice:panelGroup>
			    		</ice:panelCollapsible>
			    		
			    		<ice:panelCollapsible id="panelcollapsibleManual" expanded="false">
			    			<f:facet id="facetPanelcollapsibleManualHeader" name="header">
			    				<ice:panelGroup id="panelgroupPanelcollapsibleManual">
			    					<ice:outputText id="outputtextPanelcollapsibleManualHeader" value="Manual"></ice:outputText>
			    				</ice:panelGroup>
			    			</f:facet>
			    			<ice:panelGroup id="pnlGrpManual">
								<b>MetFusion</b> has three different parameter groups, one for MassBank, MetFrag and MetFusion itself.
								<dl>
									<dt>MassBank:</dt>
									<dd>These parameters reflect the <em>MassBank QuickSearch</em> with spectrum information.
									You can choose if your spectrum should be compared against positive, negative or both 
									<em>ionization modes</em>. Additionally, the <em>number of MassBank results</em> can be specified 
									as well as a <em>cutoff for the relative intensities</em>. This option allows to ignore 
									small intensities for spectrum comparison. Finally, the <em>instrument types</em> that were 
									used to measure a reference spectrum can be chosen. These instruments are currently 
									separated into EI, ESI and others groups.</dd>
									<dt>MetFrag:</dt>
									<dd>MetFrag requires an <em>upstream compound database</em> to look up candidate compounds. 
									To do so, an <em>exact mass</em> of the compound of interest needs to be specified. Additonal 
									tweaks to the mass search can be done via <em>search ppm</em>, <em>mz abs</em> and <em>mz ppp</em> 
									parameters. Additionally, the <em>number of candidates</em> can be specified. Further known information 
									about the compound like matching <em>database IDs</em> or the <em>molecular formular</em> can be specified 
									in order to further narrow down the list of provided candidates.</dd>
									<dt>MetFusion:</dt>
									<dd>The MetFusion parameters include the needed spectrum information as <em>peaks</em> and the 
									<em>Tanimoto clustering</em> approach.</dd>
								</dl>		    			
			    			</ice:panelGroup>
			    		</ice:panelCollapsible>
			    	</ice:panelGroup>
			    </ice:panelTab>
			    
			</ice:panelTabSet>
		</div>
		
		<div id="footer">
<!--			<ui:include src="/WEB-INF/inc-content/footer.xhtml"></ui:include>-->
		</div>
		
		<div id="feedback">
			<ice:commandButton id="openFeedbackForm" image="images/Feedback.png" style="display:block; position:fixed; top:600px; right:-1px;"
				action="#{feedbackBean.openFeedbackPopup}" immediate="false"/>
			<ice:panelPopup id="popupFeedback" modal="false" rendered="#{feedbackBean.feedbackRendered}" autoCentre="true">
				<f:facet id="facetFeedbackFormHeader" name="header">
					<ice:outputText id="putputtextFeedbackForm" value="MetFusion Feedback Form"></ice:outputText>
					<ice:commandButton id="commandbuttonFeedbackFormClose"
						image="images/close.png" action="#{feedbackBean.closeFeedbackPopup}" 
						immediate="false" style="float: right;"/>
				</f:facet>
				<f:facet id="facetFeedbackFormHBody" name="body">
					<h:panelGrid id="panelgridFeedbackForm" columns="2"> <!-- columnClasses="feedbackCol" -->
						<ice:outputLabel id="outputlabelFeedbackName" for="feedbackName" value="Name" />
						<ice:inputText id="feedbackName" value="#{feedbackBean.name}"/>
						
						<ice:outputLabel id="outputlabelFeedbackEmail" for="feedbackEmail" value="Email" />
						<ice:inputText id="feedbackEmail" value="#{feedbackBean.email}">
<!--							required="true">-->
<!--							<f:validator validatorId="emailValidator"/>-->
						</ice:inputText>
						
						<ice:outputLabel id="outputlabelFeedbackComment" for="feedbackComment" value="Comment" />
						<ice:inputTextarea id="feedbackComment" value="#{feedbackBean.comment}" rows="10"
							style="width: 300px;" validator="#{feedbackBean.validateFeedback}">
<!--							validator="#{feedbackBean.validateFeedback}"/>-->
<!--							<f:validator validatorId="feedbackValidator"></f:validator>-->
						</ice:inputTextarea>
							
						<ice:outputLabel id="outputlabelFeedbackAllowStorage"
							for="feedbackAllowStorage" value="Allow storage of settings" />
						<ice:selectBooleanCheckbox value="#{feedbackBean.allowStorage}" id="feedbackAllowStorage"
							requiredMessage="You have to allow storage of the current parameter settings in order to submit feedback! (opt-in)"/>
							
						<ice:commandButton id="submitFeedback" actionListener="#{feedbackBean.submit}" value="Send" 
							disabled="#{feedbackBean.hitOnce}"/>
						<ice:panelGroup style="float: right;">
							<ice:outputText style="color: red;" value="#{feedbackBean.error}" rendered="#{!feedbackBean.renderNote}"/>
							<ice:outputText style="color: LimeGreen;" value="#{feedbackBean.note}" rendered="#{feedbackBean.renderNote}"/>
						</ice:panelGroup>
					</h:panelGrid>
				</f:facet>
			</ice:panelPopup>
		</div>
		
	</h:form>
</h:body>
<h:outputStylesheet id="outputstylesheetCSSRime" library="org.icefaces.component.skins" name="rime.css"></h:outputStylesheet>
</html>